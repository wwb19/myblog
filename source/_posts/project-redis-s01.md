---
title:  【实践】记Redis使用实践一：项目背景
date: 2018-06-18 18:41:03
tags: 
  - 技术 
  - redis 
  - 教程
categories:
    - 技术
    - 实践
copyright: true
---

# 背景 
作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。
这次我们涉及的是支付系统中的一个功能服务，在一家大行中提供全行的交易限额控制服务。
其中这个额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。
简单概括。但是实践起来又是另一回事。

# 过程
## 划重点
当收到需求，常习惯看一遍划重点。
* 数据量
* 并发量
* 复杂度
* 一致性
* 多维度

## 分析
### 数据量
存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。

|  额度A  |  额度Ｂ  |  额度C  |
| --- | --- | --- |
|  基数x2  |  基数x42x6  |  基数x110 |
|  1亿  |  一百多亿  |  几百亿  |
当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。

### 并发量
由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右

### 复杂度
对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。

### 一致性
其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。

### 多维度
也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。

## 设计
有了上面的需求硬指标，我们就开始着手设计。
主要考虑的重点就是性能和数据量
如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。
### 性能
内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。

### 数据量
既然选择了Redis，那就从Redis开始着手进行分析解决。
内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。
在Redis的设计中，有几个通用的规范，来减少内存的开销。
* 避免大key
* 避免key和val过长
* 尽量使用ziplist数据结构

# 总结
基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。

