{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/img/avatar.jpg","path":"img/avatar.jpg","modified":1,"renderable":0}],"Cache":[{"_id":"source/CNAME","hash":"c01ddee3d7fb79d74ab2ef5e578b8ad5c29d275c","modified":1535898515908},{"_id":"source/_posts/2018-06-18-blog.md","hash":"aa820c4af38a4b62eb4d5ba69acf1dd66ad54bf2","modified":1535898487184},{"_id":"source/_posts/course-redisInstall.md","hash":"0d8f31f17798a75acd3e14759588ce42e38e9637","modified":1535898515908},{"_id":"source/_posts/hello-world.md","hash":"6a3d18918a913ab036abaaa1a787c3288ece329d","modified":1535898487184},{"_id":"source/_posts/point-welcome.md","hash":"26a35eebed8df95d14b16f6f2a949eb106dfe6fb","modified":1535898515908},{"_id":"source/_posts/project-redis-s00.md","hash":"792023a5ca9a8bca69185b17c6944375c743656c","modified":1535898515908},{"_id":"source/_posts/project-redis-s01.md","hash":"d295d5dffd3724c5f8cc1dba0f0247f6d5a2649f","modified":1535898515908},{"_id":"source/_posts/redis-s00.md","hash":"048416fa0ef22105ff14fcaee0d81bf3bb36dd12","modified":1535898487184},{"_id":"source/_posts/redis-s01.md","hash":"fef570dc4463f56dc63a8c18f00da85cba3634a4","modified":1535898487184},{"_id":"source/_posts/share-redis-summary20180722.md","hash":"558ff90276fb068fa6d5296ae4316d558dfb9cd8","modified":1535898515908},{"_id":"source/_posts/work-redisMeeting.md","hash":"993bef198fb16ddde5b4ef6f1c07ac43b0d98570","modified":1535898515908},{"_id":"source/about/index.md","hash":"33b0b389ab419327e042bc104649033264de2693","modified":1535898515908},{"_id":"source/categories/index.md","hash":"44566e91b419f42b77ac42ac8e8848d1d1e8776b","modified":1535898515908},{"_id":"source/tags/index.md","hash":"c28c6aaa700da1cc76f2e14e90862c9126df0e15","modified":1535898515908},{"_id":"source/img/avatar.jpg","hash":"caa4d2101160f729def31e1d626f0d6944492a90","modified":1535898515908},{"_id":"public/search.json","hash":"42989b0b3fa027b166b17678a2761d8f32fa76b5","modified":1535968871611},{"_id":"public/about/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/categories/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/tags/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/2018/07/22/share-redis-summary20180722/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/2018/06/22/work-redisMeeting/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/2018/06/18/course-redisInstall/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/2018/06/18/project-redis-s00/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871616},{"_id":"public/2018/06/18/project-redis-s01/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/2018/06/18/redis-s00/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/2018/06/18/redis-s01/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/2018/06/17/2018-06-18-blog/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/1984/08/08/hello-world/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/1984/08/08/point-welcome/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/技术/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/博客/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/技术/实践/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/技术/教程/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/博客/观点/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/技术/分享/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/工作/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871617},{"_id":"public/categories/工作/培训/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871618},{"_id":"public/archives/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871618},{"_id":"public/archives/page/2/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871619},{"_id":"public/archives/1984/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871620},{"_id":"public/archives/1984/08/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871620},{"_id":"public/archives/2018/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871620},{"_id":"public/archives/2018/06/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/archives/2018/07/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/生活/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/技术/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/redis/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/教程/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/生产/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/博客/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/项目/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/培训/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871621},{"_id":"public/tags/会议/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1535968871622},{"_id":"public/CNAME","hash":"c01ddee3d7fb79d74ab2ef5e578b8ad5c29d275c","modified":1535968871624},{"_id":"public/img/avatar.jpg","hash":"caa4d2101160f729def31e1d626f0d6944492a90","modified":1535968871627}],"Category":[{"name":"技术","_id":"cjlm47i6q0007y3uahp37zwc4"},{"name":"博客","_id":"cjlm47i6v000dy3ua3ewboqwx"},{"name":"实践","parent":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i70000iy3ua8stk99ic"},{"name":"教程","parent":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i73000my3uapzzobh5e"},{"name":"观点","parent":"cjlm47i6v000dy3ua3ewboqwx","_id":"cjlm47i76000sy3uamk26sqqi"},{"name":"分享","parent":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i780010y3uacnfow04f"},{"name":"工作","_id":"cjlm47i790016y3uay2nn1j82"},{"name":"培训","parent":"cjlm47i790016y3uay2nn1j82","_id":"cjlm47i7a001cy3uapmxgmuf2"}],"Data":[],"Page":[{"layout":"about","title":"About","date":"2016-04-20T20:48:33.000Z","comments":1,"_content":"","source":"about/index.md","raw":"---\nlayout: \"about\"\ntitle: \"About\"\ndate: 2016-04-21 04:48:33\ncomments: true\n---\n","updated":"2018-09-02T14:28:35.908Z","path":"about/index.html","_id":"cjlm47i6j0001y3ua28s1qj0f","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2018-06-18T09:05:24.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2018-06-18 17:05:24\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2018-09-02T14:28:35.908Z","path":"categories/index.html","comments":1,"_id":"cjlm47i6l0003y3uagpwso91s","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2018-06-18T09:04:20.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-06-18 17:04:20\ntype: \"tags\"\nlayout: \"tags\"\n---\n","updated":"2018-09-02T14:28:35.908Z","path":"tags/index.html","comments":1,"_id":"cjlm47i6p0006y3uaofk18mkb","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"我的第一个父亲节","date":"2018-06-16T17:35:46.000Z","copyright":true,"_content":"\n# 新生命的到来\n作为一个新进奶爸，第一个父亲对于我来说，就多了一个身份，即是孩子，也是父亲。\n![](http://oxigzlivh.bkt.clouddn.com/15292965985482.jpg)\n\n## 变化\n### 衣\n现在衣服，总量也许已经比我多得多咯。啊哈哈，有专门的一个大衣柜，还有床底的位置都已经放满了衣服。而且只是一岁左右的衣服，他奶奶每次逛街都会买。还有大哥哥姐姐给，哈哈哈。都可以开店咯。\n### 食\n食的方面还好，就是由于老婆只能吃清淡的，需要喂母乳，所以一切 串串小龙虾啊，她都要远离，而且还是吃吃吃。\n### 住\n住的话，就是离不开睡觉呗，摇摇床，婴儿专用的床垫啊，还有BB床，一应俱全。至于睡那一张，就看他喜爱了。哈哈哈。他最爱睡就是我们的手臂。那叫一个酸啊。\n### 行\n出行对于新生儿来说，的确是一个大工程。BB车，爸爸袋，一大堆要准备的。初学奶爸，经常忘记带东西，特别是奶瓶。被吐槽好几回咯。还有热水、45度的常温水～～～好咯，小本本跟上。\n# 两个心脏的距离\n## 喜\n的确，多了一个孩子是一件喜事。各种话题聊天都是离不开孩子的事。欢喜的是，孩子最重要是健健康康，欢欢乐乐就满足了。\n## 怒\n这个是怒，哈，都不知道是 孩子的怒，还是作为父母的怒。的确很多时候很想发火，不过，心里总是压着压着。想起一句话，自己生的娃，怎么也得认了吧。哈哈哈。\n孩子，一个就是饿，一个就是困。哭得最厉害。解决这个问题啊，孩子一笑，好像一切的怒火都没了。好咯，也许这就是作为父母的最无可奈何的地方吧。\n## 哀\n何来哀，还不是孩子的健康成长。各种担心，各种害怕。一惊一咋。不过先好多了，熟悉了孩子的脾性，也知道很多时候是怎么一回事，不会像刚刚一样，措手不及啊。\n## 乐\n孩子带来家里的笑声更多了。\n孩子的笑声，还有逗着孩子玩的笑声，满屋子都是。\n\n\n","source":"_posts/2018-06-18-blog.md","raw":"---\ntitle: 我的第一个父亲节 \ndate: 2018-06-17 01:35:46\ntags: 生活\ncopyright: true\n---\n\n# 新生命的到来\n作为一个新进奶爸，第一个父亲对于我来说，就多了一个身份，即是孩子，也是父亲。\n![](http://oxigzlivh.bkt.clouddn.com/15292965985482.jpg)\n\n## 变化\n### 衣\n现在衣服，总量也许已经比我多得多咯。啊哈哈，有专门的一个大衣柜，还有床底的位置都已经放满了衣服。而且只是一岁左右的衣服，他奶奶每次逛街都会买。还有大哥哥姐姐给，哈哈哈。都可以开店咯。\n### 食\n食的方面还好，就是由于老婆只能吃清淡的，需要喂母乳，所以一切 串串小龙虾啊，她都要远离，而且还是吃吃吃。\n### 住\n住的话，就是离不开睡觉呗，摇摇床，婴儿专用的床垫啊，还有BB床，一应俱全。至于睡那一张，就看他喜爱了。哈哈哈。他最爱睡就是我们的手臂。那叫一个酸啊。\n### 行\n出行对于新生儿来说，的确是一个大工程。BB车，爸爸袋，一大堆要准备的。初学奶爸，经常忘记带东西，特别是奶瓶。被吐槽好几回咯。还有热水、45度的常温水～～～好咯，小本本跟上。\n# 两个心脏的距离\n## 喜\n的确，多了一个孩子是一件喜事。各种话题聊天都是离不开孩子的事。欢喜的是，孩子最重要是健健康康，欢欢乐乐就满足了。\n## 怒\n这个是怒，哈，都不知道是 孩子的怒，还是作为父母的怒。的确很多时候很想发火，不过，心里总是压着压着。想起一句话，自己生的娃，怎么也得认了吧。哈哈哈。\n孩子，一个就是饿，一个就是困。哭得最厉害。解决这个问题啊，孩子一笑，好像一切的怒火都没了。好咯，也许这就是作为父母的最无可奈何的地方吧。\n## 哀\n何来哀，还不是孩子的健康成长。各种担心，各种害怕。一惊一咋。不过先好多了，熟悉了孩子的脾性，也知道很多时候是怎么一回事，不会像刚刚一样，措手不及啊。\n## 乐\n孩子带来家里的笑声更多了。\n孩子的笑声，还有逗着孩子玩的笑声，满屋子都是。\n\n\n","slug":"2018-06-18-blog","published":1,"updated":"2018-09-02T14:28:07.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6e0000y3uawq3jcxi5","content":"<h1 id=\"新生命的到来\"><a href=\"#新生命的到来\" class=\"headerlink\" title=\"新生命的到来\"></a>新生命的到来</h1><p>作为一个新进奶爸，第一个父亲对于我来说，就多了一个身份，即是孩子，也是父亲。<br><img src=\"http://oxigzlivh.bkt.clouddn.com/15292965985482.jpg\" alt=\"\"></p>\n<h2 id=\"变化\"><a href=\"#变化\" class=\"headerlink\" title=\"变化\"></a>变化</h2><h3 id=\"衣\"><a href=\"#衣\" class=\"headerlink\" title=\"衣\"></a>衣</h3><p>现在衣服，总量也许已经比我多得多咯。啊哈哈，有专门的一个大衣柜，还有床底的位置都已经放满了衣服。而且只是一岁左右的衣服，他奶奶每次逛街都会买。还有大哥哥姐姐给，哈哈哈。都可以开店咯。</p>\n<h3 id=\"食\"><a href=\"#食\" class=\"headerlink\" title=\"食\"></a>食</h3><p>食的方面还好，就是由于老婆只能吃清淡的，需要喂母乳，所以一切 串串小龙虾啊，她都要远离，而且还是吃吃吃。</p>\n<h3 id=\"住\"><a href=\"#住\" class=\"headerlink\" title=\"住\"></a>住</h3><p>住的话，就是离不开睡觉呗，摇摇床，婴儿专用的床垫啊，还有BB床，一应俱全。至于睡那一张，就看他喜爱了。哈哈哈。他最爱睡就是我们的手臂。那叫一个酸啊。</p>\n<h3 id=\"行\"><a href=\"#行\" class=\"headerlink\" title=\"行\"></a>行</h3><p>出行对于新生儿来说，的确是一个大工程。BB车，爸爸袋，一大堆要准备的。初学奶爸，经常忘记带东西，特别是奶瓶。被吐槽好几回咯。还有热水、45度的常温水～～～好咯，小本本跟上。</p>\n<h1 id=\"两个心脏的距离\"><a href=\"#两个心脏的距离\" class=\"headerlink\" title=\"两个心脏的距离\"></a>两个心脏的距离</h1><h2 id=\"喜\"><a href=\"#喜\" class=\"headerlink\" title=\"喜\"></a>喜</h2><p>的确，多了一个孩子是一件喜事。各种话题聊天都是离不开孩子的事。欢喜的是，孩子最重要是健健康康，欢欢乐乐就满足了。</p>\n<h2 id=\"怒\"><a href=\"#怒\" class=\"headerlink\" title=\"怒\"></a>怒</h2><p>这个是怒，哈，都不知道是 孩子的怒，还是作为父母的怒。的确很多时候很想发火，不过，心里总是压着压着。想起一句话，自己生的娃，怎么也得认了吧。哈哈哈。<br>孩子，一个就是饿，一个就是困。哭得最厉害。解决这个问题啊，孩子一笑，好像一切的怒火都没了。好咯，也许这就是作为父母的最无可奈何的地方吧。</p>\n<h2 id=\"哀\"><a href=\"#哀\" class=\"headerlink\" title=\"哀\"></a>哀</h2><p>何来哀，还不是孩子的健康成长。各种担心，各种害怕。一惊一咋。不过先好多了，熟悉了孩子的脾性，也知道很多时候是怎么一回事，不会像刚刚一样，措手不及啊。</p>\n<h2 id=\"乐\"><a href=\"#乐\" class=\"headerlink\" title=\"乐\"></a>乐</h2><p>孩子带来家里的笑声更多了。<br>孩子的笑声，还有逗着孩子玩的笑声，满屋子都是。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"新生命的到来\"><a href=\"#新生命的到来\" class=\"headerlink\" title=\"新生命的到来\"></a>新生命的到来</h1><p>作为一个新进奶爸，第一个父亲对于我来说，就多了一个身份，即是孩子，也是父亲。<br><img src=\"http://oxigzlivh.bkt.clouddn.com/15292965985482.jpg\" alt=\"\"></p>\n<h2 id=\"变化\"><a href=\"#变化\" class=\"headerlink\" title=\"变化\"></a>变化</h2><h3 id=\"衣\"><a href=\"#衣\" class=\"headerlink\" title=\"衣\"></a>衣</h3><p>现在衣服，总量也许已经比我多得多咯。啊哈哈，有专门的一个大衣柜，还有床底的位置都已经放满了衣服。而且只是一岁左右的衣服，他奶奶每次逛街都会买。还有大哥哥姐姐给，哈哈哈。都可以开店咯。</p>\n<h3 id=\"食\"><a href=\"#食\" class=\"headerlink\" title=\"食\"></a>食</h3><p>食的方面还好，就是由于老婆只能吃清淡的，需要喂母乳，所以一切 串串小龙虾啊，她都要远离，而且还是吃吃吃。</p>\n<h3 id=\"住\"><a href=\"#住\" class=\"headerlink\" title=\"住\"></a>住</h3><p>住的话，就是离不开睡觉呗，摇摇床，婴儿专用的床垫啊，还有BB床，一应俱全。至于睡那一张，就看他喜爱了。哈哈哈。他最爱睡就是我们的手臂。那叫一个酸啊。</p>\n<h3 id=\"行\"><a href=\"#行\" class=\"headerlink\" title=\"行\"></a>行</h3><p>出行对于新生儿来说，的确是一个大工程。BB车，爸爸袋，一大堆要准备的。初学奶爸，经常忘记带东西，特别是奶瓶。被吐槽好几回咯。还有热水、45度的常温水～～～好咯，小本本跟上。</p>\n<h1 id=\"两个心脏的距离\"><a href=\"#两个心脏的距离\" class=\"headerlink\" title=\"两个心脏的距离\"></a>两个心脏的距离</h1><h2 id=\"喜\"><a href=\"#喜\" class=\"headerlink\" title=\"喜\"></a>喜</h2><p>的确，多了一个孩子是一件喜事。各种话题聊天都是离不开孩子的事。欢喜的是，孩子最重要是健健康康，欢欢乐乐就满足了。</p>\n<h2 id=\"怒\"><a href=\"#怒\" class=\"headerlink\" title=\"怒\"></a>怒</h2><p>这个是怒，哈，都不知道是 孩子的怒，还是作为父母的怒。的确很多时候很想发火，不过，心里总是压着压着。想起一句话，自己生的娃，怎么也得认了吧。哈哈哈。<br>孩子，一个就是饿，一个就是困。哭得最厉害。解决这个问题啊，孩子一笑，好像一切的怒火都没了。好咯，也许这就是作为父母的最无可奈何的地方吧。</p>\n<h2 id=\"哀\"><a href=\"#哀\" class=\"headerlink\" title=\"哀\"></a>哀</h2><p>何来哀，还不是孩子的健康成长。各种担心，各种害怕。一惊一咋。不过先好多了，熟悉了孩子的脾性，也知道很多时候是怎么一回事，不会像刚刚一样，措手不及啊。</p>\n<h2 id=\"乐\"><a href=\"#乐\" class=\"headerlink\" title=\"乐\"></a>乐</h2><p>孩子带来家里的笑声更多了。<br>孩子的笑声，还有逗着孩子玩的笑声，满屋子都是。</p>\n"},{"title":"【教程】Redis 3.2 详细安装步骤说明","date":"2018-06-18T10:41:03.000Z","copyright":true,"_content":"\n\n# Note\n>本文用于Redis的部署安装\n>配置文件内容需根据实际情况进行设置\n>本文为Sentinel哨兵模式的集群搭建，若需Cluster集群模式，可查看Redis安装部署内容，集群安装不适合。\n\n# 一、部署说明\n\n## 集群信息\n\n* 集群：1主2从\n\n* master：主服务器\n\n* slave：从服务器\n\n同步时间间隔：1s。每秒中，slave从master进行数据同步操作。\n\n## 硬件配置要求\n\n|配置项|内容|\n| --- | --- | \n| CPU | 4c\\*2.4g | \n| 内存 | 32g |\n| 磁盘 | 1000G |\n| 系统版本 | Redhat 7.3 |\n| Redis版本 | 3.2.11 |\n\n* 哨兵集群：Redis-Sentiel\n\n相互服务发现机制，通过选举确定master是否可用。\n\n选举配置：2。意味着3台中只要有两台无法与master通讯时，进行切换master操作。\n\n* 读写分离\n\nMaster作为写服务器，Salve作为读服务器。通过数据同步，保证主从数据一致。\n\n# 二、安装部署\n\n## 1、redis安装部署步骤\n\n### Master节点安装\n\n#### 1、安装系统依赖包\n```\nyum install --downloadonly --downloaddir=/tmp/download\n```\n\n```\nyum -y install gcc automake autoconf libtool make telnet ruby-devel ruby-irb ruby-libs ruby-rdoc ruby rubygems-devel rubygems\n```\n#### 2、安装ruby包\n```\nyum -y install centos-release-scl-rh centos-release-scl\n\nsed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl.repo\n\nsed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo\n\nsed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl.repo\n\nsed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo\n\nyum --enablerepo=centos-sclo-rh -y install rh-ruby22\n\nscl enable rh-ruby22 bash\n\nruby –v\n```\n\n#### 3、安装reids ruby控制包\n\n```\ngem install redis\n```\n\n#### 4、安装redis\n```\ncd  /tmp\n\nyum install -y wget\n\nwget http://download.redis.io/releases/redis-3.2.11.tar.gz\n\ntar -zxf redis-3.2.11.tar.gz\n\ncd redis-3.2.11\n\nmake\n\ncd src &amp;&amp; make install PREFIX=/usr/local/redis\n\ncd ..\n\nmkdir /usr/local/redis/etc\n\nmkdir /usr/local/redis/db\n\ncp redis.conf /usr/local/redis/etc/\n\ncp ./src/redis-trib.rb /usr/local/redis/bin/\n```\n#### 5、修改配置文件\n```\nvi /usr/local/redis/etc/redis.conf\n\n#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信\n\nprotected-mode yes\n\ndaemonize yes #用守护模式启动\n\npidfile /var/run/redis\\_6379.pid #不同机器PID文件不一样，我们用7001-7006 #可以用同一个，但是为了统一还是建议改成不同的\n\nlogfile /var/log/redis.log\n\ndir /usr/local/redis/db/\n\nmasterauth password\n\nrequirepass password\n\nappendonly yes #开启AOF模式\n```\n\n### Slave节点安装\n\n#### 同上1-4\n\n#### 修改配置文件\n```\nvi /usr/local/redis/etc/redis.conf\n\n#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信\n\nprotected-mode yes\n\ndaemonize yes #用守护模式启动\n\nport 6379 #修改为port 6380\n\n#增加 slaveof 192.168.81.129 6380\n\nslaveof 172.20.10.12 6379\n\npidfile /var/run/redis\\_6380.pid #不同机器PID文件不一样， #可以用同一个，但是为了统一还是建议改成不同的\n\nlogfile /var/log/redis.log\n\ndir /usr/local/redis/db/\n\nmasterauth password\n\nrequirepass password\n\nappendonly yes #开启AOF模式\n```\n增加requirepass password，这是设置redis客户端或者远程机器连接redis服务器需要的密码，这里同样设为redis（6381的密码也设为redis）\n\n### Sential哨兵安装\n\n#### 安装哨兵\n\n哨兵与redis在同一服务器下，无需安装，redis自带。\n\n若与redis不在统一服务器下，可参考上redis安装1-4步骤。\n\n#### 修改配置（每个哨兵配置，除监听端口外，其他保持一致）\n```\ncd /tmp/redis-3.2.11\n```\n复制配置到 etc目录\n\n```\ncp sentinel.conf /usr/local/redis/etc/sentinel.conf\n\nvi /usr/local/redis/etc/sentinel.conf\n\n增加\n\nbind 0.0.0.0\n\n端口是 26379\n\n增加：\n\ndaemonize yes\n\nlogfile /var/log/sentinel.log\n\n搜索 sentinel monitor  下面增加\n\nsentinel monitor mymaster 172.20.10.12 6379 2\n\n对sentinel monitor mymaster 192.168.81.129 6379 2\n```\n\n解释：\nmymaster ：为主服务器起的名字；\n\n192.168.81.129 6379：主服务器的ip和端口号\n\n2：代表有2个哨兵认为主服务器主观下线时，则认为主服务器是客观下线了，可以执行主从切换，并进行故障转移操作\n\n```\n搜索 auth-pass  下面增加ps\nsentinel auth-pass mymaster password\n```\n\n## 2、集群启动\n\n### 启动redis集群：\n\n#### 服务器A：\n\nredis – 6379\n\n哨兵-26379\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n#### 服务器B：\n\nredis – 6380\n\n哨兵-26380\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n#### 服务器C：\n\nredis – 6381\n\n哨兵-26381\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n### 启动哨兵集群：\n\n#### 服务器A：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n#### 服务器B：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n#### 服务器C：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n\n\n## 3、安装验证\n\n### 集群部署验证\n```\n/usr/local/redis/bin/redis-cli\n\n  127.0.0.1:6379 auth password\n\n  OK\n\n  127.0.0.1:6379 info replication\n\n# Replication\n\nrole:master\n\nconnected\\_slaves:2\n\nslave0:ip=172.17.0.1,port=6380,state=online,offset=407,lag=1\n\nslave1:ip=172.17.0.1,port=6381,state=online,offset=407,lag=1\n\nmaster\\_repl\\_offset:407\n\nrepl\\_backlog\\_active:1\n\nrepl\\_backlog\\_size:1048576\n\nrepl\\_backlog\\_first\\_byte\\_offset:2\n\nrepl\\_backlog\\_histlen:406\n```\n\n#### 查询验证\n\n```\n/usr/local/redis/bin/redis-cli -h 172.20.10.12 -p 6380\n\n  127.0.0.1:6380 auth password\n\n  OK\n\n  127.0.0.1:6380 keys \\*\n\n  (empty list or set)\n```\n  \n#### 新增验证\n\n无\n\n","source":"_posts/course-redisInstall.md","raw":"---\ntitle:  【教程】Redis 3.2 详细安装步骤说明\ndate: 2018-06-18 18:41:03\ntags: \n   - 技术 \n   - redis \n   - 教程\n   - 生产\ncategories:\n    - 技术\n    - 教程\ncopyright: true\n---\n\n\n# Note\n>本文用于Redis的部署安装\n>配置文件内容需根据实际情况进行设置\n>本文为Sentinel哨兵模式的集群搭建，若需Cluster集群模式，可查看Redis安装部署内容，集群安装不适合。\n\n# 一、部署说明\n\n## 集群信息\n\n* 集群：1主2从\n\n* master：主服务器\n\n* slave：从服务器\n\n同步时间间隔：1s。每秒中，slave从master进行数据同步操作。\n\n## 硬件配置要求\n\n|配置项|内容|\n| --- | --- | \n| CPU | 4c\\*2.4g | \n| 内存 | 32g |\n| 磁盘 | 1000G |\n| 系统版本 | Redhat 7.3 |\n| Redis版本 | 3.2.11 |\n\n* 哨兵集群：Redis-Sentiel\n\n相互服务发现机制，通过选举确定master是否可用。\n\n选举配置：2。意味着3台中只要有两台无法与master通讯时，进行切换master操作。\n\n* 读写分离\n\nMaster作为写服务器，Salve作为读服务器。通过数据同步，保证主从数据一致。\n\n# 二、安装部署\n\n## 1、redis安装部署步骤\n\n### Master节点安装\n\n#### 1、安装系统依赖包\n```\nyum install --downloadonly --downloaddir=/tmp/download\n```\n\n```\nyum -y install gcc automake autoconf libtool make telnet ruby-devel ruby-irb ruby-libs ruby-rdoc ruby rubygems-devel rubygems\n```\n#### 2、安装ruby包\n```\nyum -y install centos-release-scl-rh centos-release-scl\n\nsed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl.repo\n\nsed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo\n\nsed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl.repo\n\nsed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo\n\nyum --enablerepo=centos-sclo-rh -y install rh-ruby22\n\nscl enable rh-ruby22 bash\n\nruby –v\n```\n\n#### 3、安装reids ruby控制包\n\n```\ngem install redis\n```\n\n#### 4、安装redis\n```\ncd  /tmp\n\nyum install -y wget\n\nwget http://download.redis.io/releases/redis-3.2.11.tar.gz\n\ntar -zxf redis-3.2.11.tar.gz\n\ncd redis-3.2.11\n\nmake\n\ncd src &amp;&amp; make install PREFIX=/usr/local/redis\n\ncd ..\n\nmkdir /usr/local/redis/etc\n\nmkdir /usr/local/redis/db\n\ncp redis.conf /usr/local/redis/etc/\n\ncp ./src/redis-trib.rb /usr/local/redis/bin/\n```\n#### 5、修改配置文件\n```\nvi /usr/local/redis/etc/redis.conf\n\n#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信\n\nprotected-mode yes\n\ndaemonize yes #用守护模式启动\n\npidfile /var/run/redis\\_6379.pid #不同机器PID文件不一样，我们用7001-7006 #可以用同一个，但是为了统一还是建议改成不同的\n\nlogfile /var/log/redis.log\n\ndir /usr/local/redis/db/\n\nmasterauth password\n\nrequirepass password\n\nappendonly yes #开启AOF模式\n```\n\n### Slave节点安装\n\n#### 同上1-4\n\n#### 修改配置文件\n```\nvi /usr/local/redis/etc/redis.conf\n\n#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信\n\nprotected-mode yes\n\ndaemonize yes #用守护模式启动\n\nport 6379 #修改为port 6380\n\n#增加 slaveof 192.168.81.129 6380\n\nslaveof 172.20.10.12 6379\n\npidfile /var/run/redis\\_6380.pid #不同机器PID文件不一样， #可以用同一个，但是为了统一还是建议改成不同的\n\nlogfile /var/log/redis.log\n\ndir /usr/local/redis/db/\n\nmasterauth password\n\nrequirepass password\n\nappendonly yes #开启AOF模式\n```\n增加requirepass password，这是设置redis客户端或者远程机器连接redis服务器需要的密码，这里同样设为redis（6381的密码也设为redis）\n\n### Sential哨兵安装\n\n#### 安装哨兵\n\n哨兵与redis在同一服务器下，无需安装，redis自带。\n\n若与redis不在统一服务器下，可参考上redis安装1-4步骤。\n\n#### 修改配置（每个哨兵配置，除监听端口外，其他保持一致）\n```\ncd /tmp/redis-3.2.11\n```\n复制配置到 etc目录\n\n```\ncp sentinel.conf /usr/local/redis/etc/sentinel.conf\n\nvi /usr/local/redis/etc/sentinel.conf\n\n增加\n\nbind 0.0.0.0\n\n端口是 26379\n\n增加：\n\ndaemonize yes\n\nlogfile /var/log/sentinel.log\n\n搜索 sentinel monitor  下面增加\n\nsentinel monitor mymaster 172.20.10.12 6379 2\n\n对sentinel monitor mymaster 192.168.81.129 6379 2\n```\n\n解释：\nmymaster ：为主服务器起的名字；\n\n192.168.81.129 6379：主服务器的ip和端口号\n\n2：代表有2个哨兵认为主服务器主观下线时，则认为主服务器是客观下线了，可以执行主从切换，并进行故障转移操作\n\n```\n搜索 auth-pass  下面增加ps\nsentinel auth-pass mymaster password\n```\n\n## 2、集群启动\n\n### 启动redis集群：\n\n#### 服务器A：\n\nredis – 6379\n\n哨兵-26379\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n#### 服务器B：\n\nredis – 6380\n\n哨兵-26380\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n#### 服务器C：\n\nredis – 6381\n\n哨兵-26381\n\n/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\n\n### 启动哨兵集群：\n\n#### 服务器A：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n#### 服务器B：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n#### 服务器C：\n\n/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf\n\n\n\n## 3、安装验证\n\n### 集群部署验证\n```\n/usr/local/redis/bin/redis-cli\n\n  127.0.0.1:6379 auth password\n\n  OK\n\n  127.0.0.1:6379 info replication\n\n# Replication\n\nrole:master\n\nconnected\\_slaves:2\n\nslave0:ip=172.17.0.1,port=6380,state=online,offset=407,lag=1\n\nslave1:ip=172.17.0.1,port=6381,state=online,offset=407,lag=1\n\nmaster\\_repl\\_offset:407\n\nrepl\\_backlog\\_active:1\n\nrepl\\_backlog\\_size:1048576\n\nrepl\\_backlog\\_first\\_byte\\_offset:2\n\nrepl\\_backlog\\_histlen:406\n```\n\n#### 查询验证\n\n```\n/usr/local/redis/bin/redis-cli -h 172.20.10.12 -p 6380\n\n  127.0.0.1:6380 auth password\n\n  OK\n\n  127.0.0.1:6380 keys \\*\n\n  (empty list or set)\n```\n  \n#### 新增验证\n\n无\n\n","slug":"course-redisInstall","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6k0002y3ua51lvuze3","content":"<h1 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h1><blockquote>\n<p>本文用于Redis的部署安装<br>配置文件内容需根据实际情况进行设置<br>本文为Sentinel哨兵模式的集群搭建，若需Cluster集群模式，可查看Redis安装部署内容，集群安装不适合。</p>\n</blockquote>\n<h1 id=\"一、部署说明\"><a href=\"#一、部署说明\" class=\"headerlink\" title=\"一、部署说明\"></a>一、部署说明</h1><h2 id=\"集群信息\"><a href=\"#集群信息\" class=\"headerlink\" title=\"集群信息\"></a>集群信息</h2><ul>\n<li><p>集群：1主2从</p>\n</li>\n<li><p>master：主服务器</p>\n</li>\n<li><p>slave：从服务器</p>\n</li>\n</ul>\n<p>同步时间间隔：1s。每秒中，slave从master进行数据同步操作。</p>\n<h2 id=\"硬件配置要求\"><a href=\"#硬件配置要求\" class=\"headerlink\" title=\"硬件配置要求\"></a>硬件配置要求</h2><table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CPU</td>\n<td>4c*2.4g</td>\n</tr>\n<tr>\n<td>内存</td>\n<td>32g</td>\n</tr>\n<tr>\n<td>磁盘</td>\n<td>1000G</td>\n</tr>\n<tr>\n<td>系统版本</td>\n<td>Redhat 7.3</td>\n</tr>\n<tr>\n<td>Redis版本</td>\n<td>3.2.11</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>哨兵集群：Redis-Sentiel</li>\n</ul>\n<p>相互服务发现机制，通过选举确定master是否可用。</p>\n<p>选举配置：2。意味着3台中只要有两台无法与master通讯时，进行切换master操作。</p>\n<ul>\n<li>读写分离</li>\n</ul>\n<p>Master作为写服务器，Salve作为读服务器。通过数据同步，保证主从数据一致。</p>\n<h1 id=\"二、安装部署\"><a href=\"#二、安装部署\" class=\"headerlink\" title=\"二、安装部署\"></a>二、安装部署</h1><h2 id=\"1、redis安装部署步骤\"><a href=\"#1、redis安装部署步骤\" class=\"headerlink\" title=\"1、redis安装部署步骤\"></a>1、redis安装部署步骤</h2><h3 id=\"Master节点安装\"><a href=\"#Master节点安装\" class=\"headerlink\" title=\"Master节点安装\"></a>Master节点安装</h3><h4 id=\"1、安装系统依赖包\"><a href=\"#1、安装系统依赖包\" class=\"headerlink\" title=\"1、安装系统依赖包\"></a>1、安装系统依赖包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install --downloadonly --downloaddir=/tmp/download</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc automake autoconf libtool make telnet ruby-devel ruby-irb ruby-libs ruby-rdoc ruby rubygems-devel rubygems</span><br></pre></td></tr></table></figure>\n<h4 id=\"2、安装ruby包\"><a href=\"#2、安装ruby包\" class=\"headerlink\" title=\"2、安装ruby包\"></a>2、安装ruby包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install centos-release-scl-rh centos-release-scl</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo</span><br><span class=\"line\"></span><br><span class=\"line\">yum --enablerepo=centos-sclo-rh -y install rh-ruby22</span><br><span class=\"line\"></span><br><span class=\"line\">scl enable rh-ruby22 bash</span><br><span class=\"line\"></span><br><span class=\"line\">ruby –v</span><br></pre></td></tr></table></figure>\n<h4 id=\"3、安装reids-ruby控制包\"><a href=\"#3、安装reids-ruby控制包\" class=\"headerlink\" title=\"3、安装reids ruby控制包\"></a>3、安装reids ruby控制包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem install redis</span><br></pre></td></tr></table></figure>\n<h4 id=\"4、安装redis\"><a href=\"#4、安装redis\" class=\"headerlink\" title=\"4、安装redis\"></a>4、安装redis</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd  /tmp</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y wget</span><br><span class=\"line\"></span><br><span class=\"line\">wget http://download.redis.io/releases/redis-3.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxf redis-3.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">cd redis-3.2.11</span><br><span class=\"line\"></span><br><span class=\"line\">make</span><br><span class=\"line\"></span><br><span class=\"line\">cd src &amp;amp;&amp;amp; make install PREFIX=/usr/local/redis</span><br><span class=\"line\"></span><br><span class=\"line\">cd ..</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /usr/local/redis/etc</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /usr/local/redis/db</span><br><span class=\"line\"></span><br><span class=\"line\">cp redis.conf /usr/local/redis/etc/</span><br><span class=\"line\"></span><br><span class=\"line\">cp ./src/redis-trib.rb /usr/local/redis/bin/</span><br></pre></td></tr></table></figure>\n<h4 id=\"5、修改配置文件\"><a href=\"#5、修改配置文件\" class=\"headerlink\" title=\"5、修改配置文件\"></a>5、修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/redis/etc/redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信</span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode yes</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes #用守护模式启动</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile /var/run/redis\\_6379.pid #不同机器PID文件不一样，我们用7001-7006 #可以用同一个，但是为了统一还是建议改成不同的</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/redis.log</span><br><span class=\"line\"></span><br><span class=\"line\">dir /usr/local/redis/db/</span><br><span class=\"line\"></span><br><span class=\"line\">masterauth password</span><br><span class=\"line\"></span><br><span class=\"line\">requirepass password</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #开启AOF模式</span><br></pre></td></tr></table></figure>\n<h3 id=\"Slave节点安装\"><a href=\"#Slave节点安装\" class=\"headerlink\" title=\"Slave节点安装\"></a>Slave节点安装</h3><h4 id=\"同上1-4\"><a href=\"#同上1-4\" class=\"headerlink\" title=\"同上1-4\"></a>同上1-4</h4><h4 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/redis/etc/redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信</span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode yes</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes #用守护模式启动</span><br><span class=\"line\"></span><br><span class=\"line\">port 6379 #修改为port 6380</span><br><span class=\"line\"></span><br><span class=\"line\">#增加 slaveof 192.168.81.129 6380</span><br><span class=\"line\"></span><br><span class=\"line\">slaveof 172.20.10.12 6379</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile /var/run/redis\\_6380.pid #不同机器PID文件不一样， #可以用同一个，但是为了统一还是建议改成不同的</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/redis.log</span><br><span class=\"line\"></span><br><span class=\"line\">dir /usr/local/redis/db/</span><br><span class=\"line\"></span><br><span class=\"line\">masterauth password</span><br><span class=\"line\"></span><br><span class=\"line\">requirepass password</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #开启AOF模式</span><br></pre></td></tr></table></figure>\n<p>增加requirepass password，这是设置redis客户端或者远程机器连接redis服务器需要的密码，这里同样设为redis（6381的密码也设为redis）</p>\n<h3 id=\"Sential哨兵安装\"><a href=\"#Sential哨兵安装\" class=\"headerlink\" title=\"Sential哨兵安装\"></a>Sential哨兵安装</h3><h4 id=\"安装哨兵\"><a href=\"#安装哨兵\" class=\"headerlink\" title=\"安装哨兵\"></a>安装哨兵</h4><p>哨兵与redis在同一服务器下，无需安装，redis自带。</p>\n<p>若与redis不在统一服务器下，可参考上redis安装1-4步骤。</p>\n<h4 id=\"修改配置（每个哨兵配置，除监听端口外，其他保持一致）\"><a href=\"#修改配置（每个哨兵配置，除监听端口外，其他保持一致）\" class=\"headerlink\" title=\"修改配置（每个哨兵配置，除监听端口外，其他保持一致）\"></a>修改配置（每个哨兵配置，除监听端口外，其他保持一致）</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /tmp/redis-3.2.11</span><br></pre></td></tr></table></figure>\n<p>复制配置到 etc目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp sentinel.conf /usr/local/redis/etc/sentinel.conf</span><br><span class=\"line\"></span><br><span class=\"line\">vi /usr/local/redis/etc/sentinel.conf</span><br><span class=\"line\"></span><br><span class=\"line\">增加</span><br><span class=\"line\"></span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\">端口是 26379</span><br><span class=\"line\"></span><br><span class=\"line\">增加：</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/sentinel.log</span><br><span class=\"line\"></span><br><span class=\"line\">搜索 sentinel monitor  下面增加</span><br><span class=\"line\"></span><br><span class=\"line\">sentinel monitor mymaster 172.20.10.12 6379 2</span><br><span class=\"line\"></span><br><span class=\"line\">对sentinel monitor mymaster 192.168.81.129 6379 2</span><br></pre></td></tr></table></figure>\n<p>解释：<br>mymaster ：为主服务器起的名字；</p>\n<p>192.168.81.129 6379：主服务器的ip和端口号</p>\n<p>2：代表有2个哨兵认为主服务器主观下线时，则认为主服务器是客观下线了，可以执行主从切换，并进行故障转移操作</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">搜索 auth-pass  下面增加ps</span><br><span class=\"line\">sentinel auth-pass mymaster password</span><br></pre></td></tr></table></figure>\n<h2 id=\"2、集群启动\"><a href=\"#2、集群启动\" class=\"headerlink\" title=\"2、集群启动\"></a>2、集群启动</h2><h3 id=\"启动redis集群：\"><a href=\"#启动redis集群：\" class=\"headerlink\" title=\"启动redis集群：\"></a>启动redis集群：</h3><h4 id=\"服务器A：\"><a href=\"#服务器A：\" class=\"headerlink\" title=\"服务器A：\"></a>服务器A：</h4><p>redis – 6379</p>\n<p>哨兵-26379</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h4 id=\"服务器B：\"><a href=\"#服务器B：\" class=\"headerlink\" title=\"服务器B：\"></a>服务器B：</h4><p>redis – 6380</p>\n<p>哨兵-26380</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h4 id=\"服务器C：\"><a href=\"#服务器C：\" class=\"headerlink\" title=\"服务器C：\"></a>服务器C：</h4><p>redis – 6381</p>\n<p>哨兵-26381</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h3 id=\"启动哨兵集群：\"><a href=\"#启动哨兵集群：\" class=\"headerlink\" title=\"启动哨兵集群：\"></a>启动哨兵集群：</h3><h4 id=\"服务器A：-1\"><a href=\"#服务器A：-1\" class=\"headerlink\" title=\"服务器A：\"></a>服务器A：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h4 id=\"服务器B：-1\"><a href=\"#服务器B：-1\" class=\"headerlink\" title=\"服务器B：\"></a>服务器B：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h4 id=\"服务器C：-1\"><a href=\"#服务器C：-1\" class=\"headerlink\" title=\"服务器C：\"></a>服务器C：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h2 id=\"3、安装验证\"><a href=\"#3、安装验证\" class=\"headerlink\" title=\"3、安装验证\"></a>3、安装验证</h2><h3 id=\"集群部署验证\"><a href=\"#集群部署验证\" class=\"headerlink\" title=\"集群部署验证\"></a>集群部署验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/redis/bin/redis-cli</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6379 auth password</span><br><span class=\"line\"></span><br><span class=\"line\">  OK</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6379 info replication</span><br><span class=\"line\"></span><br><span class=\"line\"># Replication</span><br><span class=\"line\"></span><br><span class=\"line\">role:master</span><br><span class=\"line\"></span><br><span class=\"line\">connected\\_slaves:2</span><br><span class=\"line\"></span><br><span class=\"line\">slave0:ip=172.17.0.1,port=6380,state=online,offset=407,lag=1</span><br><span class=\"line\"></span><br><span class=\"line\">slave1:ip=172.17.0.1,port=6381,state=online,offset=407,lag=1</span><br><span class=\"line\"></span><br><span class=\"line\">master\\_repl\\_offset:407</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_active:1</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_size:1048576</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_first\\_byte\\_offset:2</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_histlen:406</span><br></pre></td></tr></table></figure>\n<h4 id=\"查询验证\"><a href=\"#查询验证\" class=\"headerlink\" title=\"查询验证\"></a>查询验证</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/redis/bin/redis-cli -h 172.20.10.12 -p 6380</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6380 auth password</span><br><span class=\"line\"></span><br><span class=\"line\">  OK</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6380 keys \\*</span><br><span class=\"line\"></span><br><span class=\"line\">  (empty list or set)</span><br></pre></td></tr></table></figure>\n<h4 id=\"新增验证\"><a href=\"#新增验证\" class=\"headerlink\" title=\"新增验证\"></a>新增验证</h4><p>无</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h1><blockquote>\n<p>本文用于Redis的部署安装<br>配置文件内容需根据实际情况进行设置<br>本文为Sentinel哨兵模式的集群搭建，若需Cluster集群模式，可查看Redis安装部署内容，集群安装不适合。</p>\n</blockquote>\n<h1 id=\"一、部署说明\"><a href=\"#一、部署说明\" class=\"headerlink\" title=\"一、部署说明\"></a>一、部署说明</h1><h2 id=\"集群信息\"><a href=\"#集群信息\" class=\"headerlink\" title=\"集群信息\"></a>集群信息</h2><ul>\n<li><p>集群：1主2从</p>\n</li>\n<li><p>master：主服务器</p>\n</li>\n<li><p>slave：从服务器</p>\n</li>\n</ul>\n<p>同步时间间隔：1s。每秒中，slave从master进行数据同步操作。</p>\n<h2 id=\"硬件配置要求\"><a href=\"#硬件配置要求\" class=\"headerlink\" title=\"硬件配置要求\"></a>硬件配置要求</h2><table>\n<thead>\n<tr>\n<th>配置项</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CPU</td>\n<td>4c*2.4g</td>\n</tr>\n<tr>\n<td>内存</td>\n<td>32g</td>\n</tr>\n<tr>\n<td>磁盘</td>\n<td>1000G</td>\n</tr>\n<tr>\n<td>系统版本</td>\n<td>Redhat 7.3</td>\n</tr>\n<tr>\n<td>Redis版本</td>\n<td>3.2.11</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>哨兵集群：Redis-Sentiel</li>\n</ul>\n<p>相互服务发现机制，通过选举确定master是否可用。</p>\n<p>选举配置：2。意味着3台中只要有两台无法与master通讯时，进行切换master操作。</p>\n<ul>\n<li>读写分离</li>\n</ul>\n<p>Master作为写服务器，Salve作为读服务器。通过数据同步，保证主从数据一致。</p>\n<h1 id=\"二、安装部署\"><a href=\"#二、安装部署\" class=\"headerlink\" title=\"二、安装部署\"></a>二、安装部署</h1><h2 id=\"1、redis安装部署步骤\"><a href=\"#1、redis安装部署步骤\" class=\"headerlink\" title=\"1、redis安装部署步骤\"></a>1、redis安装部署步骤</h2><h3 id=\"Master节点安装\"><a href=\"#Master节点安装\" class=\"headerlink\" title=\"Master节点安装\"></a>Master节点安装</h3><h4 id=\"1、安装系统依赖包\"><a href=\"#1、安装系统依赖包\" class=\"headerlink\" title=\"1、安装系统依赖包\"></a>1、安装系统依赖包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install --downloadonly --downloaddir=/tmp/download</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc automake autoconf libtool make telnet ruby-devel ruby-irb ruby-libs ruby-rdoc ruby rubygems-devel rubygems</span><br></pre></td></tr></table></figure>\n<h4 id=\"2、安装ruby包\"><a href=\"#2、安装ruby包\" class=\"headerlink\" title=\"2、安装ruby包\"></a>2、安装ruby包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install centos-release-scl-rh centos-release-scl</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/\\]$/\\]\\npriority=10/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl.repo</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i -e s/enabled=1/enabled=0/g /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo</span><br><span class=\"line\"></span><br><span class=\"line\">yum --enablerepo=centos-sclo-rh -y install rh-ruby22</span><br><span class=\"line\"></span><br><span class=\"line\">scl enable rh-ruby22 bash</span><br><span class=\"line\"></span><br><span class=\"line\">ruby –v</span><br></pre></td></tr></table></figure>\n<h4 id=\"3、安装reids-ruby控制包\"><a href=\"#3、安装reids-ruby控制包\" class=\"headerlink\" title=\"3、安装reids ruby控制包\"></a>3、安装reids ruby控制包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem install redis</span><br></pre></td></tr></table></figure>\n<h4 id=\"4、安装redis\"><a href=\"#4、安装redis\" class=\"headerlink\" title=\"4、安装redis\"></a>4、安装redis</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd  /tmp</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y wget</span><br><span class=\"line\"></span><br><span class=\"line\">wget http://download.redis.io/releases/redis-3.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxf redis-3.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">cd redis-3.2.11</span><br><span class=\"line\"></span><br><span class=\"line\">make</span><br><span class=\"line\"></span><br><span class=\"line\">cd src &amp;amp;&amp;amp; make install PREFIX=/usr/local/redis</span><br><span class=\"line\"></span><br><span class=\"line\">cd ..</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /usr/local/redis/etc</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /usr/local/redis/db</span><br><span class=\"line\"></span><br><span class=\"line\">cp redis.conf /usr/local/redis/etc/</span><br><span class=\"line\"></span><br><span class=\"line\">cp ./src/redis-trib.rb /usr/local/redis/bin/</span><br></pre></td></tr></table></figure>\n<h4 id=\"5、修改配置文件\"><a href=\"#5、修改配置文件\" class=\"headerlink\" title=\"5、修改配置文件\"></a>5、修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/redis/etc/redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信</span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode yes</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes #用守护模式启动</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile /var/run/redis\\_6379.pid #不同机器PID文件不一样，我们用7001-7006 #可以用同一个，但是为了统一还是建议改成不同的</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/redis.log</span><br><span class=\"line\"></span><br><span class=\"line\">dir /usr/local/redis/db/</span><br><span class=\"line\"></span><br><span class=\"line\">masterauth password</span><br><span class=\"line\"></span><br><span class=\"line\">requirepass password</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #开启AOF模式</span><br></pre></td></tr></table></figure>\n<h3 id=\"Slave节点安装\"><a href=\"#Slave节点安装\" class=\"headerlink\" title=\"Slave节点安装\"></a>Slave节点安装</h3><h4 id=\"同上1-4\"><a href=\"#同上1-4\" class=\"headerlink\" title=\"同上1-4\"></a>同上1-4</h4><h4 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/redis/etc/redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#bind 127.0.0.1 #这里注释掉，否则会导致其它节点无法与本节点通信</span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode yes</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes #用守护模式启动</span><br><span class=\"line\"></span><br><span class=\"line\">port 6379 #修改为port 6380</span><br><span class=\"line\"></span><br><span class=\"line\">#增加 slaveof 192.168.81.129 6380</span><br><span class=\"line\"></span><br><span class=\"line\">slaveof 172.20.10.12 6379</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile /var/run/redis\\_6380.pid #不同机器PID文件不一样， #可以用同一个，但是为了统一还是建议改成不同的</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/redis.log</span><br><span class=\"line\"></span><br><span class=\"line\">dir /usr/local/redis/db/</span><br><span class=\"line\"></span><br><span class=\"line\">masterauth password</span><br><span class=\"line\"></span><br><span class=\"line\">requirepass password</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #开启AOF模式</span><br></pre></td></tr></table></figure>\n<p>增加requirepass password，这是设置redis客户端或者远程机器连接redis服务器需要的密码，这里同样设为redis（6381的密码也设为redis）</p>\n<h3 id=\"Sential哨兵安装\"><a href=\"#Sential哨兵安装\" class=\"headerlink\" title=\"Sential哨兵安装\"></a>Sential哨兵安装</h3><h4 id=\"安装哨兵\"><a href=\"#安装哨兵\" class=\"headerlink\" title=\"安装哨兵\"></a>安装哨兵</h4><p>哨兵与redis在同一服务器下，无需安装，redis自带。</p>\n<p>若与redis不在统一服务器下，可参考上redis安装1-4步骤。</p>\n<h4 id=\"修改配置（每个哨兵配置，除监听端口外，其他保持一致）\"><a href=\"#修改配置（每个哨兵配置，除监听端口外，其他保持一致）\" class=\"headerlink\" title=\"修改配置（每个哨兵配置，除监听端口外，其他保持一致）\"></a>修改配置（每个哨兵配置，除监听端口外，其他保持一致）</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /tmp/redis-3.2.11</span><br></pre></td></tr></table></figure>\n<p>复制配置到 etc目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp sentinel.conf /usr/local/redis/etc/sentinel.conf</span><br><span class=\"line\"></span><br><span class=\"line\">vi /usr/local/redis/etc/sentinel.conf</span><br><span class=\"line\"></span><br><span class=\"line\">增加</span><br><span class=\"line\"></span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\">端口是 26379</span><br><span class=\"line\"></span><br><span class=\"line\">增加：</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\"></span><br><span class=\"line\">logfile /var/log/sentinel.log</span><br><span class=\"line\"></span><br><span class=\"line\">搜索 sentinel monitor  下面增加</span><br><span class=\"line\"></span><br><span class=\"line\">sentinel monitor mymaster 172.20.10.12 6379 2</span><br><span class=\"line\"></span><br><span class=\"line\">对sentinel monitor mymaster 192.168.81.129 6379 2</span><br></pre></td></tr></table></figure>\n<p>解释：<br>mymaster ：为主服务器起的名字；</p>\n<p>192.168.81.129 6379：主服务器的ip和端口号</p>\n<p>2：代表有2个哨兵认为主服务器主观下线时，则认为主服务器是客观下线了，可以执行主从切换，并进行故障转移操作</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">搜索 auth-pass  下面增加ps</span><br><span class=\"line\">sentinel auth-pass mymaster password</span><br></pre></td></tr></table></figure>\n<h2 id=\"2、集群启动\"><a href=\"#2、集群启动\" class=\"headerlink\" title=\"2、集群启动\"></a>2、集群启动</h2><h3 id=\"启动redis集群：\"><a href=\"#启动redis集群：\" class=\"headerlink\" title=\"启动redis集群：\"></a>启动redis集群：</h3><h4 id=\"服务器A：\"><a href=\"#服务器A：\" class=\"headerlink\" title=\"服务器A：\"></a>服务器A：</h4><p>redis – 6379</p>\n<p>哨兵-26379</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h4 id=\"服务器B：\"><a href=\"#服务器B：\" class=\"headerlink\" title=\"服务器B：\"></a>服务器B：</h4><p>redis – 6380</p>\n<p>哨兵-26380</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h4 id=\"服务器C：\"><a href=\"#服务器C：\" class=\"headerlink\" title=\"服务器C：\"></a>服务器C：</h4><p>redis – 6381</p>\n<p>哨兵-26381</p>\n<p>/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</p>\n<h3 id=\"启动哨兵集群：\"><a href=\"#启动哨兵集群：\" class=\"headerlink\" title=\"启动哨兵集群：\"></a>启动哨兵集群：</h3><h4 id=\"服务器A：-1\"><a href=\"#服务器A：-1\" class=\"headerlink\" title=\"服务器A：\"></a>服务器A：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h4 id=\"服务器B：-1\"><a href=\"#服务器B：-1\" class=\"headerlink\" title=\"服务器B：\"></a>服务器B：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h4 id=\"服务器C：-1\"><a href=\"#服务器C：-1\" class=\"headerlink\" title=\"服务器C：\"></a>服务器C：</h4><p>/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf</p>\n<h2 id=\"3、安装验证\"><a href=\"#3、安装验证\" class=\"headerlink\" title=\"3、安装验证\"></a>3、安装验证</h2><h3 id=\"集群部署验证\"><a href=\"#集群部署验证\" class=\"headerlink\" title=\"集群部署验证\"></a>集群部署验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/redis/bin/redis-cli</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6379 auth password</span><br><span class=\"line\"></span><br><span class=\"line\">  OK</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6379 info replication</span><br><span class=\"line\"></span><br><span class=\"line\"># Replication</span><br><span class=\"line\"></span><br><span class=\"line\">role:master</span><br><span class=\"line\"></span><br><span class=\"line\">connected\\_slaves:2</span><br><span class=\"line\"></span><br><span class=\"line\">slave0:ip=172.17.0.1,port=6380,state=online,offset=407,lag=1</span><br><span class=\"line\"></span><br><span class=\"line\">slave1:ip=172.17.0.1,port=6381,state=online,offset=407,lag=1</span><br><span class=\"line\"></span><br><span class=\"line\">master\\_repl\\_offset:407</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_active:1</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_size:1048576</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_first\\_byte\\_offset:2</span><br><span class=\"line\"></span><br><span class=\"line\">repl\\_backlog\\_histlen:406</span><br></pre></td></tr></table></figure>\n<h4 id=\"查询验证\"><a href=\"#查询验证\" class=\"headerlink\" title=\"查询验证\"></a>查询验证</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/redis/bin/redis-cli -h 172.20.10.12 -p 6380</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6380 auth password</span><br><span class=\"line\"></span><br><span class=\"line\">  OK</span><br><span class=\"line\"></span><br><span class=\"line\">  127.0.0.1:6380 keys \\*</span><br><span class=\"line\"></span><br><span class=\"line\">  (empty list or set)</span><br></pre></td></tr></table></figure>\n<h4 id=\"新增验证\"><a href=\"#新增验证\" class=\"headerlink\" title=\"新增验证\"></a>新增验证</h4><p>无</p>\n"},{"title":"Welcome on WWB1984","date":"1984-08-08T00:08:08.000Z","copyright":true,"top":true,"_content":"\n# Welcome My World\n首先，欢迎大家到来。\n这是第一篇的文章，后续我会继续在这里分享。\n当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。\n希望能够珍惜彼此短短的交集。\n谢谢。\n\n## 声明：\n1、不要当键盘侠，前提。本人玻璃心受不了。\n2、有错就认，欢迎提出。\n3、版权相关，请标明出处。\n","source":"_posts/hello-world.md","raw":"---\ntitle: Welcome on WWB1984\ndate: 1984-08-08 08:08:08\ntags: 博客\ncopyright: true\ntop: true\n---\n\n# Welcome My World\n首先，欢迎大家到来。\n这是第一篇的文章，后续我会继续在这里分享。\n当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。\n希望能够珍惜彼此短短的交集。\n谢谢。\n\n## 声明：\n1、不要当键盘侠，前提。本人玻璃心受不了。\n2、有错就认，欢迎提出。\n3、版权相关，请标明出处。\n","slug":"hello-world","published":1,"updated":"2018-09-02T14:28:07.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6o0005y3uavx2nmza2","content":"<h1 id=\"Welcome-My-World\"><a href=\"#Welcome-My-World\" class=\"headerlink\" title=\"Welcome My World\"></a>Welcome My World</h1><p>首先，欢迎大家到来。<br>这是第一篇的文章，后续我会继续在这里分享。<br>当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。<br>希望能够珍惜彼此短短的交集。<br>谢谢。</p>\n<h2 id=\"声明：\"><a href=\"#声明：\" class=\"headerlink\" title=\"声明：\"></a>声明：</h2><p>1、不要当键盘侠，前提。本人玻璃心受不了。<br>2、有错就认，欢迎提出。<br>3、版权相关，请标明出处。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Welcome-My-World\"><a href=\"#Welcome-My-World\" class=\"headerlink\" title=\"Welcome My World\"></a>Welcome My World</h1><p>首先，欢迎大家到来。<br>这是第一篇的文章，后续我会继续在这里分享。<br>当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。<br>希望能够珍惜彼此短短的交集。<br>谢谢。</p>\n<h2 id=\"声明：\"><a href=\"#声明：\" class=\"headerlink\" title=\"声明：\"></a>声明：</h2><p>1、不要当键盘侠，前提。本人玻璃心受不了。<br>2、有错就认，欢迎提出。<br>3、版权相关，请标明出处。</p>\n"},{"title":"Welcome on WWB1984","date":"1984-08-08T00:08:08.000Z","copyright":true,"top":true,"_content":"\n# Welcome My World\n首先，欢迎大家到来。\n这是第一篇的文章，后续我会继续在这里分享。\n当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。\n希望能够珍惜彼此短短的交集。\n谢谢。\n\n## 声明：\n1、不要当键盘侠，前提。本人玻璃心受不了。\n2、有错就认，欢迎提出。\n3、版权相关，请标明出处。\n\n\n","source":"_posts/point-welcome.md","raw":"---\ntitle: Welcome on WWB1984\ndate: 1984-08-08 08:08:08\ntags: 生活\ncategories:\n    - 博客\n    - 观点\ncopyright: true\ntop: true\n---\n\n# Welcome My World\n首先，欢迎大家到来。\n这是第一篇的文章，后续我会继续在这里分享。\n当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。\n希望能够珍惜彼此短短的交集。\n谢谢。\n\n## 声明：\n1、不要当键盘侠，前提。本人玻璃心受不了。\n2、有错就认，欢迎提出。\n3、版权相关，请标明出处。\n\n\n","slug":"point-welcome","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6r0008y3uaavfy53nj","content":"<h1 id=\"Welcome-My-World\"><a href=\"#Welcome-My-World\" class=\"headerlink\" title=\"Welcome My World\"></a>Welcome My World</h1><p>首先，欢迎大家到来。<br>这是第一篇的文章，后续我会继续在这里分享。<br>当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。<br>希望能够珍惜彼此短短的交集。<br>谢谢。</p>\n<h2 id=\"声明：\"><a href=\"#声明：\" class=\"headerlink\" title=\"声明：\"></a>声明：</h2><p>1、不要当键盘侠，前提。本人玻璃心受不了。<br>2、有错就认，欢迎提出。<br>3、版权相关，请标明出处。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Welcome-My-World\"><a href=\"#Welcome-My-World\" class=\"headerlink\" title=\"Welcome My World\"></a>Welcome My World</h1><p>首先，欢迎大家到来。<br>这是第一篇的文章，后续我会继续在这里分享。<br>当你看到里面的每一段文字，也是我们不同平行线上的交集。是幸运、更是幸福。<br>希望能够珍惜彼此短短的交集。<br>谢谢。</p>\n<h2 id=\"声明：\"><a href=\"#声明：\" class=\"headerlink\" title=\"声明：\"></a>声明：</h2><p>1、不要当键盘侠，前提。本人玻璃心受不了。<br>2、有错就认，欢迎提出。<br>3、版权相关，请标明出处。</p>\n"},{"title":"【项目】记Redis使用实践-介绍","date":"2018-06-18T10:41:03.000Z","copyright":true,"_content":"# 大纲\n* 一、项目背景\n* 二、数据结构\n* 三、Redis使用\n* 四、Redis数据同步\n* 五、特别场景说明\n* 六、总结优化\n\n# 感受\n  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。\n  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。\n  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。\n  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。\n\n","source":"_posts/project-redis-s00.md","raw":"---\ntitle:  【项目】记Redis使用实践-介绍\ndate: 2018-06-18 18:41:03\ntags: \n   - 技术 \n   - redis \n   - 教程\ncategories:\n    - 技术\n    - 实践\ncopyright: true\n---\n# 大纲\n* 一、项目背景\n* 二、数据结构\n* 三、Redis使用\n* 四、Redis数据同步\n* 五、特别场景说明\n* 六、总结优化\n\n# 感受\n  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。\n  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。\n  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。\n  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。\n\n","slug":"project-redis-s00","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6s0009y3uac8k9u37c","content":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li>一、项目背景</li>\n<li>二、数据结构</li>\n<li>三、Redis使用</li>\n<li>四、Redis数据同步</li>\n<li>五、特别场景说明</li>\n<li>六、总结优化</li>\n</ul>\n<h1 id=\"感受\"><a href=\"#感受\" class=\"headerlink\" title=\"感受\"></a>感受</h1><p>  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。<br>  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。<br>  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。<br>  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li>一、项目背景</li>\n<li>二、数据结构</li>\n<li>三、Redis使用</li>\n<li>四、Redis数据同步</li>\n<li>五、特别场景说明</li>\n<li>六、总结优化</li>\n</ul>\n<h1 id=\"感受\"><a href=\"#感受\" class=\"headerlink\" title=\"感受\"></a>感受</h1><p>  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。<br>  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。<br>  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。<br>  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。</p>\n"},{"title":"【实践】记Redis使用实践一：项目背景","date":"2018-06-18T10:41:03.000Z","copyright":true,"_content":"\n# 背景 \n作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。\n这次我们涉及的是支付系统中的一个功能服务，在一家大行中提供全行的交易限额控制服务。\n其中这个额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。\n简单概括。但是实践起来又是另一回事。\n\n# 过程\n## 划重点\n当收到需求，常习惯看一遍划重点。\n* 数据量\n* 并发量\n* 复杂度\n* 一致性\n* 多维度\n\n## 分析\n### 数据量\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  基数x2  |  基数x42x6  |  基数x110 |\n|  1亿  |  一百多亿  |  几百亿  |\n当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。\n\n### 并发量\n由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右\n\n### 复杂度\n对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。\n\n### 一致性\n其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。\n\n### 多维度\n也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。\n\n## 设计\n有了上面的需求硬指标，我们就开始着手设计。\n主要考虑的重点就是性能和数据量\n如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。\n### 性能\n内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。\n\n### 数据量\n既然选择了Redis，那就从Redis开始着手进行分析解决。\n内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。\n在Redis的设计中，有几个通用的规范，来减少内存的开销。\n* 避免大key\n* 避免key和val过长\n* 尽量使用ziplist数据结构\n\n# 总结\n基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。\n\n","source":"_posts/project-redis-s01.md","raw":"---\ntitle:  【实践】记Redis使用实践一：项目背景\ndate: 2018-06-18 18:41:03\ntags: \n  - 技术 \n  - redis \n  - 教程\ncategories:\n    - 技术\n    - 实践\ncopyright: true\n---\n\n# 背景 \n作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。\n这次我们涉及的是支付系统中的一个功能服务，在一家大行中提供全行的交易限额控制服务。\n其中这个额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。\n简单概括。但是实践起来又是另一回事。\n\n# 过程\n## 划重点\n当收到需求，常习惯看一遍划重点。\n* 数据量\n* 并发量\n* 复杂度\n* 一致性\n* 多维度\n\n## 分析\n### 数据量\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  基数x2  |  基数x42x6  |  基数x110 |\n|  1亿  |  一百多亿  |  几百亿  |\n当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。\n\n### 并发量\n由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右\n\n### 复杂度\n对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。\n\n### 一致性\n其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。\n\n### 多维度\n也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。\n\n## 设计\n有了上面的需求硬指标，我们就开始着手设计。\n主要考虑的重点就是性能和数据量\n如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。\n### 性能\n内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。\n\n### 数据量\n既然选择了Redis，那就从Redis开始着手进行分析解决。\n内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。\n在Redis的设计中，有几个通用的规范，来减少内存的开销。\n* 避免大key\n* 避免key和val过长\n* 尽量使用ziplist数据结构\n\n# 总结\n基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。\n\n","slug":"project-redis-s01","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6u000cy3ua0y7tww0w","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。<br>这次我们涉及的是支付系统中的一个功能服务，在一家大行中提供全行的交易限额控制服务。<br>其中这个额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。<br>简单概括。但是实践起来又是另一回事。</p>\n<h1 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h1><h2 id=\"划重点\"><a href=\"#划重点\" class=\"headerlink\" title=\"划重点\"></a>划重点</h2><p>当收到需求，常习惯看一遍划重点。</p>\n<ul>\n<li>数据量</li>\n<li>并发量</li>\n<li>复杂度</li>\n<li>一致性</li>\n<li>多维度</li>\n</ul>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><h3 id=\"数据量\"><a href=\"#数据量\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>基数x2</td>\n<td>基数x42x6</td>\n<td>基数x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>一百多亿</td>\n<td>几百亿</td>\n</tr>\n</tbody>\n</table>\n<p>当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。</p>\n<h3 id=\"并发量\"><a href=\"#并发量\" class=\"headerlink\" title=\"并发量\"></a>并发量</h3><p>由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。</p>\n<h3 id=\"一致性\"><a href=\"#一致性\" class=\"headerlink\" title=\"一致性\"></a>一致性</h3><p>其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。</p>\n<h3 id=\"多维度\"><a href=\"#多维度\" class=\"headerlink\" title=\"多维度\"></a>多维度</h3><p>也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。</p>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p>有了上面的需求硬指标，我们就开始着手设计。<br>主要考虑的重点就是性能和数据量<br>如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。</p>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><p>内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。</p>\n<h3 id=\"数据量-1\"><a href=\"#数据量-1\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>既然选择了Redis，那就从Redis开始着手进行分析解决。<br>内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。<br>在Redis的设计中，有几个通用的规范，来减少内存的开销。</p>\n<ul>\n<li>避免大key</li>\n<li>避免key和val过长</li>\n<li>尽量使用ziplist数据结构</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。<br>这次我们涉及的是支付系统中的一个功能服务，在一家大行中提供全行的交易限额控制服务。<br>其中这个额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。<br>简单概括。但是实践起来又是另一回事。</p>\n<h1 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h1><h2 id=\"划重点\"><a href=\"#划重点\" class=\"headerlink\" title=\"划重点\"></a>划重点</h2><p>当收到需求，常习惯看一遍划重点。</p>\n<ul>\n<li>数据量</li>\n<li>并发量</li>\n<li>复杂度</li>\n<li>一致性</li>\n<li>多维度</li>\n</ul>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><h3 id=\"数据量\"><a href=\"#数据量\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>基数x2</td>\n<td>基数x42x6</td>\n<td>基数x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>一百多亿</td>\n<td>几百亿</td>\n</tr>\n</tbody>\n</table>\n<p>当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。</p>\n<h3 id=\"并发量\"><a href=\"#并发量\" class=\"headerlink\" title=\"并发量\"></a>并发量</h3><p>由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。</p>\n<h3 id=\"一致性\"><a href=\"#一致性\" class=\"headerlink\" title=\"一致性\"></a>一致性</h3><p>其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。</p>\n<h3 id=\"多维度\"><a href=\"#多维度\" class=\"headerlink\" title=\"多维度\"></a>多维度</h3><p>也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。</p>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p>有了上面的需求硬指标，我们就开始着手设计。<br>主要考虑的重点就是性能和数据量<br>如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。</p>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><p>内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。</p>\n<h3 id=\"数据量-1\"><a href=\"#数据量-1\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>既然选择了Redis，那就从Redis开始着手进行分析解决。<br>内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。<br>在Redis的设计中，有几个通用的规范，来减少内存的开销。</p>\n<ul>\n<li>避免大key</li>\n<li>避免key和val过长</li>\n<li>尽量使用ziplist数据结构</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。</p>\n"},{"title":"【记Redis使用实践】分享","date":"2018-06-18T10:41:03.000Z","copyright":true,"_content":"# 大纲\n* 一、项目背景\n* 二、数据结构\n* 三、Redis使用\n* 四、Redis数据同步\n* 五、特别场景说明\n* 六、总结优化\n\n# 感受\n  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。\n  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。\n  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。\n  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。","source":"_posts/redis-s00.md","raw":"---\ntitle:  【记Redis使用实践】分享\ndate: 2018-06-18 18:41:03\ntags: \n   - 技术 \n   - redis \n   - 教程\ncopyright: true\n---\n# 大纲\n* 一、项目背景\n* 二、数据结构\n* 三、Redis使用\n* 四、Redis数据同步\n* 五、特别场景说明\n* 六、总结优化\n\n# 感受\n  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。\n  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。\n  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。\n  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。","slug":"redis-s00","published":1,"updated":"2018-09-02T14:28:07.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6w000fy3uajyvx4wug","content":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li>一、项目背景</li>\n<li>二、数据结构</li>\n<li>三、Redis使用</li>\n<li>四、Redis数据同步</li>\n<li>五、特别场景说明</li>\n<li>六、总结优化</li>\n</ul>\n<h1 id=\"感受\"><a href=\"#感受\" class=\"headerlink\" title=\"感受\"></a>感受</h1><p>  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。<br>  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。<br>  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。<br>  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li>一、项目背景</li>\n<li>二、数据结构</li>\n<li>三、Redis使用</li>\n<li>四、Redis数据同步</li>\n<li>五、特别场景说明</li>\n<li>六、总结优化</li>\n</ul>\n<h1 id=\"感受\"><a href=\"#感受\" class=\"headerlink\" title=\"感受\"></a>感受</h1><p>  从今年的3月底，接收到一个蛮有挑战的任务，就是用redis解决目前项目的一个额度服务需求。<br>  领导很简单地说了几句，用Redis就可以解决，当然我也觉得就一个内存的k-v数据库，应该也还好，就接收了这个任务。<br>  接触发现，Redis涉及的面不少，不单单数据结构，还有深入需求后发现，其实数据结构也是一个很大的挑战，因为单单同步表数据，量有点大。走序列化，跟已有的技术平台不太兼容，最后只能选择重新设计数据结构，进行映射。<br>  最后，经过几个月的学习研究。从一个没有接触过Redis的小白，总算折腾出了一个以Redis作为缓存的额度服务系统。希望能够分享出来。</p>\n"},{"title":"【记Redis使用实践一】项目背景","date":"2018-06-18T10:41:03.000Z","copyright":true,"_content":"\n# 背景 \n作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。\n这次我们涉及的是一个支付系统中的一个功能服务，在一家大行中提供全行的交易额度限制服务。\n其中额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。\n简单概括。但是实践起来又是另一回事。\n\n# 过程\n## 划重点\n当收到需求，常习惯看一遍划重点。\n* 数据量\n* 并发量\n* 复杂度\n* 一致性\n* 多维度\n\n## 分析\n### 数据量\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  2  |  42x6  |  6x18x110 |\n|  1亿  |  一百多亿  |  上千亿  |\n当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。\n\n### 并发量\n由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右\n\n### 复杂度\n对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。\n\n### 一致性\n其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。\n\n### 多维度\n也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。\n\n## 设计\n有了上面的需求硬指标，我们就开始着手设计。\n主要考虑的重点就是性能和数据量\n如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。\n### 性能\n内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。\n\n### 数据量\n既然选择了Redis，那就从Redis开始着手进行分析解决。\n内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。\n在Redis的设计中，有几个通用的规范，来减少内存的开销。\n* 避免大key\n* 避免key和val过长\n* 尽量使用ziplist数据结构\n\n# 总结\n基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。","source":"_posts/redis-s01.md","raw":"---\ntitle:  【记Redis使用实践一】项目背景\ndate: 2018-06-18 18:41:03\ntags: \n  - 技术 \n  - redis \n  - 教程\ncopyright: true\n---\n\n# 背景 \n作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。\n这次我们涉及的是一个支付系统中的一个功能服务，在一家大行中提供全行的交易额度限制服务。\n其中额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。\n简单概括。但是实践起来又是另一回事。\n\n# 过程\n## 划重点\n当收到需求，常习惯看一遍划重点。\n* 数据量\n* 并发量\n* 复杂度\n* 一致性\n* 多维度\n\n## 分析\n### 数据量\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  2  |  42x6  |  6x18x110 |\n|  1亿  |  一百多亿  |  上千亿  |\n当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。\n\n### 并发量\n由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右\n\n### 复杂度\n对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。\n\n### 一致性\n其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。\n\n### 多维度\n也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。\n\n## 设计\n有了上面的需求硬指标，我们就开始着手设计。\n主要考虑的重点就是性能和数据量\n如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。\n### 性能\n内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。\n\n### 数据量\n既然选择了Redis，那就从Redis开始着手进行分析解决。\n内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。\n在Redis的设计中，有几个通用的规范，来减少内存的开销。\n* 避免大key\n* 避免key和val过长\n* 尽量使用ziplist数据结构\n\n# 总结\n基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。","slug":"redis-s01","published":1,"updated":"2018-09-02T14:28:07.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i6z000hy3uap6iel80y","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。<br>这次我们涉及的是一个支付系统中的一个功能服务，在一家大行中提供全行的交易额度限制服务。<br>其中额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。<br>简单概括。但是实践起来又是另一回事。</p>\n<h1 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h1><h2 id=\"划重点\"><a href=\"#划重点\" class=\"headerlink\" title=\"划重点\"></a>划重点</h2><p>当收到需求，常习惯看一遍划重点。</p>\n<ul>\n<li>数据量</li>\n<li>并发量</li>\n<li>复杂度</li>\n<li>一致性</li>\n<li>多维度</li>\n</ul>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><h3 id=\"数据量\"><a href=\"#数据量\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2</td>\n<td>42x6</td>\n<td>6x18x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>一百多亿</td>\n<td>上千亿</td>\n</tr>\n</tbody>\n</table>\n<p>当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。</p>\n<h3 id=\"并发量\"><a href=\"#并发量\" class=\"headerlink\" title=\"并发量\"></a>并发量</h3><p>由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。</p>\n<h3 id=\"一致性\"><a href=\"#一致性\" class=\"headerlink\" title=\"一致性\"></a>一致性</h3><p>其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。</p>\n<h3 id=\"多维度\"><a href=\"#多维度\" class=\"headerlink\" title=\"多维度\"></a>多维度</h3><p>也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。</p>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p>有了上面的需求硬指标，我们就开始着手设计。<br>主要考虑的重点就是性能和数据量<br>如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。</p>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><p>内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。</p>\n<h3 id=\"数据量-1\"><a href=\"#数据量-1\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>既然选择了Redis，那就从Redis开始着手进行分析解决。<br>内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。<br>在Redis的设计中，有几个通用的规范，来减少内存的开销。</p>\n<ul>\n<li>避免大key</li>\n<li>避免key和val过长</li>\n<li>尽量使用ziplist数据结构</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>作为程序员一个，多年来的工作习惯，啥都是要讲需求背景，所以直接来干货。<br>这次我们涉及的是一个支付系统中的一个功能服务，在一家大行中提供全行的交易额度限制服务。<br>其中额度不单单只是一维的限制，还需要根据不同的场景和对接系统，提供多个不同纬度的额度限制。<br>简单概括。但是实践起来又是另一回事。</p>\n<h1 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h1><h2 id=\"划重点\"><a href=\"#划重点\" class=\"headerlink\" title=\"划重点\"></a>划重点</h2><p>当收到需求，常习惯看一遍划重点。</p>\n<ul>\n<li>数据量</li>\n<li>并发量</li>\n<li>复杂度</li>\n<li>一致性</li>\n<li>多维度</li>\n</ul>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><h3 id=\"数据量\"><a href=\"#数据量\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2</td>\n<td>42x6</td>\n<td>6x18x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>一百多亿</td>\n<td>上千亿</td>\n</tr>\n</tbody>\n</table>\n<p>当然，基本不太可能全部量都同时存在，不过基于进行评估需要，仍然以此作为评估的基数。</p>\n<h3 id=\"并发量\"><a href=\"#并发量\" class=\"headerlink\" title=\"并发量\"></a>并发量</h3><p>由于属于支付系统，要求的TPS是2000左右。在双11或者秒杀活动中，这个TPS可能还会进一步提升。 因此初步设计需要约5000TPS左右</p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>对于系统的需求其实比较简单，比起那些复杂的支付逻辑来说，这个还是比较简单。但是由于考虑的是系统的通用性和扩展性，这个就没法根据需求来硬编码了。</p>\n<h3 id=\"一致性\"><a href=\"#一致性\" class=\"headerlink\" title=\"一致性\"></a>一致性</h3><p>其实这个在数据库来说，意思就是事务一致性。因为需要对于多个额度同时进行控制，所以如何保证多个额度能一起累计或一起撤回，是考虑的重要规则之一。</p>\n<h3 id=\"多维度\"><a href=\"#多维度\" class=\"headerlink\" title=\"多维度\"></a>多维度</h3><p>也是基于需求背景，结合复杂度和一致性考虑，如何处理不同纬度的额度限制，并且能够具有一定的扩展性。</p>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p>有了上面的需求硬指标，我们就开始着手设计。<br>主要考虑的重点就是性能和数据量<br>如何在大的用户基数下也能兼顾高并发的访问性能，相信很多人都会有这个疑问。现在介绍一下我们的思路。</p>\n<h3 id=\"性能\"><a href=\"#性能\" class=\"headerlink\" title=\"性能\"></a>性能</h3><p>内存存储，考虑到这么高的并发访问，而且存在高读写的要求，基于这个我们决定使用Redis作为我们数据的存储。</p>\n<h3 id=\"数据量-1\"><a href=\"#数据量-1\" class=\"headerlink\" title=\"数据量\"></a>数据量</h3><p>既然选择了Redis，那就从Redis开始着手进行分析解决。<br>内存能不能存放这么大的数据量呢？答案是可以。不过合不合理，适不适合，又是另一件事了。<br>在Redis的设计中，有几个通用的规范，来减少内存的开销。</p>\n<ul>\n<li>避免大key</li>\n<li>避免key和val过长</li>\n<li>尽量使用ziplist数据结构</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>基本介绍了项目的背景和设计所需考虑的一些关键点，下一章节将详细说明一下数据结构。</p>\n"},{"title":"【分享】限额控制的Redis实践","date":"2018-07-22T15:03:03.000Z","copyright":true,"_content":"\n# 大纲\n* [需求](#overview)\n* [思考与方案](#useage)\n* [实现与困难](#stage)\n* [效果与总结](#summary)\n\n# 一、需求\n<a id=\"overview\"></a>\n* 需求比较简单，主要是实现多个维度的客户限额控制需求。每个限额的控制有多个的维度进行分别累计控制，还包括了单笔、日累计和月累计的方式。\n* 需要支持多个不同接入系统，而且需要考虑未来的业务扩展性。\n* 能够具有较强的实时性、响应性，而且能够稳定可持续运行。\n\n# 二、思考与方案\n<a id=\"useage\"></a>\n由于考虑这次项目是在支付系统中使用，常用场景是日常的高访问的支付场景以及一些秒杀、双十一等促销场景，而且涉及具有较大规模的基础用户量。自然而然，就想到了使用内存数据库进行处理。\n\n## 缓存or数据库\n内存数据库，顾名思义就是把数据放在内存中，直接把内存当作数据库使用。缓存，是内存数据库的应用场景之一，将进程使用的数据存在内存，达到共享、快速访问、减少数据交互的作用。但缓存毕竟不是数据库，缓存是可重新加载可丢失，而数据库却必须支持持久化、高可用、一致性的。\n在项目初期，我们基本考虑把数据存放在内存中。但随着项目的推进，压力测试、验证等各方面的工作开展，我们发现直接使用内存作为数据库在不可丢失数据的场景下，是无法满足要求的。至少，为了保持整个内存数据库的高可用、持久化，也许我们需要更多其他的工作来达到。\n因此，我们最终定型存储结构是Redis当作数据缓存以达到高并发的读写要求，DB2作为持久化数据库，最终数据需同步到DB2为准，也跟市场主流的用法类似。\n\n## 选用Redis\n缓存方案：Redis、ehcache、kafka等很多不同的方案。考虑行里已有Redis的实施经验，而且Redis提供的数据类型更为丰富，最重要是Redis支持持久化和成熟的高可用方案，初步定型为Redis。\n\n# 三、实现与困难\n<a id=\"stage\"></a>\n万事起头难，从无到有的确需要经过很多不同的实践和验证。从开始以为Redis只是普通的get/set操作，常用的k-v结构存储之外，其实对于一个成熟可用的方案考虑的还不止这些。\n\n## 数据存储\n* 数据规模\n\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  基数x2  |  基数x42  |  基数x110 |\n|  1亿  |  十多亿  |  几百亿  |\n\n* 数据结构\n\n在如何规模的数量下，对于数据库都需要采取各种方案来进行提高性能和访问速度，还有节省空间。更何况是存储量级只有硬盘十分之一不到的内存呢。 \n在项目初期，确定以Redis为数据存储，DB2为数据存储的方案，与大多的方案不太一样。大多的方案是Redis的数据结构与数据库的表结构一致，根据不同的key来定义或划分数据。\n\n数据库：\n\n```\nLimitRecord1(\nuserid,recordval1,...\n)\nLimitRecord2(\nuserid,condition2,recordva2,...\n)\n```\n方案一：\n\n```\nRedis：\nLimitRecord1:userid{\n    recordval1:value,\n    ...\n}\nLimitRecord2:userid:condition2{\n    recordval2:value,\n    ...\n}\n\n```\n方案二：\n\n```\nRedis:\nuserid:{\n    LimitRecord1:recordval1\n    LimitRecord2.condition2:recordval1\n}\n```\n\n至于那种方式更好，见仁见智，在此我们提供不同思路给大家思考。\n对于缓存方案，多读少写第一种方案更合适。以Redis作为存储方案二相对更加节省内存使用，更适合k-v的存储数据结构。\n\n## Redis字段优化\n \n 在日常中，缓存往往只是少量数据，如配置项、热点数据等，而本项目中，Redis承载的数据规模日常热点在几千万键的级别中，因此每一个小的字符串优化，效果都很明显也很重要。\n优化前：\n\n```\nlimitkey.userid.cardtype等组合\n```\n优化后：\n\n```\nl.u.c 等组合\n甚至有些改为1.2.3纯数字代替\n```\n的确我们同事说的，这可读性降低很多，不过面对寸金尺土的内存空间，这优化还是很必要。\n\n另外，在Redis内存不同的数据结构对于内存的使用大小也是天差地别。\n\n|  存储结构  |  数据量（万）  |  数据格式  |内存大小|rdb文件大小|\n| --- | --- | --- |---|---|\n|  hash  |  15000  |  ziplist |10.77G|1.6G\n|  hash  |  15000  |  hashtable  |20.62G|6.9G\n\n当然我们也做了很多其他不同的字段优化和测试，在此边幅有限不一一详述。\n\n## 事务处理与lua脚本\n由于涉及多个限额的累计或回退、多个限额值（日累计、月累计）的一致性要求，数据库可提供事务机制实现，在Redis中，又是如何实现的。\nRedis提供了基础的事务功能，不过涉及到锁的机制，因此对于开发要求比较高。另一方面，Redis本身每次操作都是原子性的，所以也可通过lua脚本实现。我们本次项目采取的是后者。\n\nlua脚本并不复杂，但是lua脚本类似数据库的存储过程，一旦执行，若存在死循环或者大数据量操作，对于Redis来说是致命的。因此不建议常用，也不建议滥用，我们组员很多时间都觉得，lua可以做，就可以避免多次访问Redis，减少开销。不过遇到此类场景，并没有一致性要求的，建议使用hmset、hmget等批操作，或者pipeline等方式进行访问，避免使用lua此类脚本，减少风险和排查难度。\n\n## Redis与数据库同步\n在文章开头，提到一点很重要，也是项目必须面对的，就是Redis究竟是作为数据库还是缓存，这对于数据落地、高可用等设计都会涉及。\n目前定位是Redis缓存、DB作为数据落地，因此如何把Redis中的数据同步到数据库也是我们纠结很久的困难点。\n\n### 同步机制\n在Redis本身是支持类似队列或订阅机制，意味着我们可以考虑使用这两个方式触发数据同步。\n但由于Redis的队列机制是不完整的，不完整指的是Redis并不是提供一个类似MQ、rabbitMQ等专门的队列机制，因此不建议Redis的队列服务与本身Redis的存储服务一同使用，有可能会导致队列堵塞而导致存储服务无法使用。\n因此，项目使用了公司平台本身的队列服务，Redis仍然作为缓冲服务，避免由于高并发量和突发大数据量而导致系统不可用。\n\n### 数据结构映射\n如何把Redis的存储数据与数据库表结构对应，也是我们面对的问题之一。因此大多的方式是，Redis当缓存或临时的热点数据，允许在一段周期后进行丢弃，也就是说可不用回写数据库，但本项目中的数据，最长的时间是月，这个是无法丢弃的。并且如何对于这么大的数据量在Redis中进行清理，也是一个难题。\n\n\n### 解决方案\n另一方面，本项目采取的数据结构与数据库表结构也不一致，无法直接从Redis的数据中回写数据库。\n我们的处理方式就是不进行同步，Redis和数据库单独管理。每次通讯请求，通过开关判断，开关用于判断使用Redis或者DB。当默认使用Redis时，程序将请求同步发送至Redis限额控制服务，当Redis处理结果成功后，将请求异步发送至平台队列中，DB限额控制服务将从队列获取信息进行处理。\n\n\n　![](http://oxigzlivh.bkt.clouddn.com/2018-07-22-15322700497055.jpg)\n\n\n# 四、效果与总结\n<a id=\"summary\"></a>\n目前项目仍在开发中准备投产，效果如何仍需结合生产的运行情况，我们再进一步总结和归纳经验。本项目在Redis中的前期做了不少的实践，不过更多没落到实处，主要集中在性能和用法上的实践。但在项目开展时会遇到不少的难题需要解决，特别结合复杂的业务场景下，无法使用关系型数据库进行数据关联查询，无法使用事务机制控制提交回滚，更无法使用索引主键等控制约束，都是我们缺乏思考的地方。\n下一步我们需要完善的是运维和监控，在追求速度的开发节奏和生产性能的当下，如何能够让快速的系统健康稳定运行，相对应的故障发现和自动化运维机制是必不可少的。期待下一次的分享。\n\n","source":"_posts/share-redis-summary20180722.md","raw":"---\ntitle:  【分享】限额控制的Redis实践\ndate: 2018-07-22 23:03:03\ntags: \n    - 技术 \n    - redis \n    - 项目\n    - 生产\ncategories:\n    - 技术\n    - 分享\ncopyright: true\n---\n\n# 大纲\n* [需求](#overview)\n* [思考与方案](#useage)\n* [实现与困难](#stage)\n* [效果与总结](#summary)\n\n# 一、需求\n<a id=\"overview\"></a>\n* 需求比较简单，主要是实现多个维度的客户限额控制需求。每个限额的控制有多个的维度进行分别累计控制，还包括了单笔、日累计和月累计的方式。\n* 需要支持多个不同接入系统，而且需要考虑未来的业务扩展性。\n* 能够具有较强的实时性、响应性，而且能够稳定可持续运行。\n\n# 二、思考与方案\n<a id=\"useage\"></a>\n由于考虑这次项目是在支付系统中使用，常用场景是日常的高访问的支付场景以及一些秒杀、双十一等促销场景，而且涉及具有较大规模的基础用户量。自然而然，就想到了使用内存数据库进行处理。\n\n## 缓存or数据库\n内存数据库，顾名思义就是把数据放在内存中，直接把内存当作数据库使用。缓存，是内存数据库的应用场景之一，将进程使用的数据存在内存，达到共享、快速访问、减少数据交互的作用。但缓存毕竟不是数据库，缓存是可重新加载可丢失，而数据库却必须支持持久化、高可用、一致性的。\n在项目初期，我们基本考虑把数据存放在内存中。但随着项目的推进，压力测试、验证等各方面的工作开展，我们发现直接使用内存作为数据库在不可丢失数据的场景下，是无法满足要求的。至少，为了保持整个内存数据库的高可用、持久化，也许我们需要更多其他的工作来达到。\n因此，我们最终定型存储结构是Redis当作数据缓存以达到高并发的读写要求，DB2作为持久化数据库，最终数据需同步到DB2为准，也跟市场主流的用法类似。\n\n## 选用Redis\n缓存方案：Redis、ehcache、kafka等很多不同的方案。考虑行里已有Redis的实施经验，而且Redis提供的数据类型更为丰富，最重要是Redis支持持久化和成熟的高可用方案，初步定型为Redis。\n\n# 三、实现与困难\n<a id=\"stage\"></a>\n万事起头难，从无到有的确需要经过很多不同的实践和验证。从开始以为Redis只是普通的get/set操作，常用的k-v结构存储之外，其实对于一个成熟可用的方案考虑的还不止这些。\n\n## 数据存储\n* 数据规模\n\n存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。\n\n|  额度A  |  额度Ｂ  |  额度C  |\n| --- | --- | --- |\n|  基数x2  |  基数x42  |  基数x110 |\n|  1亿  |  十多亿  |  几百亿  |\n\n* 数据结构\n\n在如何规模的数量下，对于数据库都需要采取各种方案来进行提高性能和访问速度，还有节省空间。更何况是存储量级只有硬盘十分之一不到的内存呢。 \n在项目初期，确定以Redis为数据存储，DB2为数据存储的方案，与大多的方案不太一样。大多的方案是Redis的数据结构与数据库的表结构一致，根据不同的key来定义或划分数据。\n\n数据库：\n\n```\nLimitRecord1(\nuserid,recordval1,...\n)\nLimitRecord2(\nuserid,condition2,recordva2,...\n)\n```\n方案一：\n\n```\nRedis：\nLimitRecord1:userid{\n    recordval1:value,\n    ...\n}\nLimitRecord2:userid:condition2{\n    recordval2:value,\n    ...\n}\n\n```\n方案二：\n\n```\nRedis:\nuserid:{\n    LimitRecord1:recordval1\n    LimitRecord2.condition2:recordval1\n}\n```\n\n至于那种方式更好，见仁见智，在此我们提供不同思路给大家思考。\n对于缓存方案，多读少写第一种方案更合适。以Redis作为存储方案二相对更加节省内存使用，更适合k-v的存储数据结构。\n\n## Redis字段优化\n \n 在日常中，缓存往往只是少量数据，如配置项、热点数据等，而本项目中，Redis承载的数据规模日常热点在几千万键的级别中，因此每一个小的字符串优化，效果都很明显也很重要。\n优化前：\n\n```\nlimitkey.userid.cardtype等组合\n```\n优化后：\n\n```\nl.u.c 等组合\n甚至有些改为1.2.3纯数字代替\n```\n的确我们同事说的，这可读性降低很多，不过面对寸金尺土的内存空间，这优化还是很必要。\n\n另外，在Redis内存不同的数据结构对于内存的使用大小也是天差地别。\n\n|  存储结构  |  数据量（万）  |  数据格式  |内存大小|rdb文件大小|\n| --- | --- | --- |---|---|\n|  hash  |  15000  |  ziplist |10.77G|1.6G\n|  hash  |  15000  |  hashtable  |20.62G|6.9G\n\n当然我们也做了很多其他不同的字段优化和测试，在此边幅有限不一一详述。\n\n## 事务处理与lua脚本\n由于涉及多个限额的累计或回退、多个限额值（日累计、月累计）的一致性要求，数据库可提供事务机制实现，在Redis中，又是如何实现的。\nRedis提供了基础的事务功能，不过涉及到锁的机制，因此对于开发要求比较高。另一方面，Redis本身每次操作都是原子性的，所以也可通过lua脚本实现。我们本次项目采取的是后者。\n\nlua脚本并不复杂，但是lua脚本类似数据库的存储过程，一旦执行，若存在死循环或者大数据量操作，对于Redis来说是致命的。因此不建议常用，也不建议滥用，我们组员很多时间都觉得，lua可以做，就可以避免多次访问Redis，减少开销。不过遇到此类场景，并没有一致性要求的，建议使用hmset、hmget等批操作，或者pipeline等方式进行访问，避免使用lua此类脚本，减少风险和排查难度。\n\n## Redis与数据库同步\n在文章开头，提到一点很重要，也是项目必须面对的，就是Redis究竟是作为数据库还是缓存，这对于数据落地、高可用等设计都会涉及。\n目前定位是Redis缓存、DB作为数据落地，因此如何把Redis中的数据同步到数据库也是我们纠结很久的困难点。\n\n### 同步机制\n在Redis本身是支持类似队列或订阅机制，意味着我们可以考虑使用这两个方式触发数据同步。\n但由于Redis的队列机制是不完整的，不完整指的是Redis并不是提供一个类似MQ、rabbitMQ等专门的队列机制，因此不建议Redis的队列服务与本身Redis的存储服务一同使用，有可能会导致队列堵塞而导致存储服务无法使用。\n因此，项目使用了公司平台本身的队列服务，Redis仍然作为缓冲服务，避免由于高并发量和突发大数据量而导致系统不可用。\n\n### 数据结构映射\n如何把Redis的存储数据与数据库表结构对应，也是我们面对的问题之一。因此大多的方式是，Redis当缓存或临时的热点数据，允许在一段周期后进行丢弃，也就是说可不用回写数据库，但本项目中的数据，最长的时间是月，这个是无法丢弃的。并且如何对于这么大的数据量在Redis中进行清理，也是一个难题。\n\n\n### 解决方案\n另一方面，本项目采取的数据结构与数据库表结构也不一致，无法直接从Redis的数据中回写数据库。\n我们的处理方式就是不进行同步，Redis和数据库单独管理。每次通讯请求，通过开关判断，开关用于判断使用Redis或者DB。当默认使用Redis时，程序将请求同步发送至Redis限额控制服务，当Redis处理结果成功后，将请求异步发送至平台队列中，DB限额控制服务将从队列获取信息进行处理。\n\n\n　![](http://oxigzlivh.bkt.clouddn.com/2018-07-22-15322700497055.jpg)\n\n\n# 四、效果与总结\n<a id=\"summary\"></a>\n目前项目仍在开发中准备投产，效果如何仍需结合生产的运行情况，我们再进一步总结和归纳经验。本项目在Redis中的前期做了不少的实践，不过更多没落到实处，主要集中在性能和用法上的实践。但在项目开展时会遇到不少的难题需要解决，特别结合复杂的业务场景下，无法使用关系型数据库进行数据关联查询，无法使用事务机制控制提交回滚，更无法使用索引主键等控制约束，都是我们缺乏思考的地方。\n下一步我们需要完善的是运维和监控，在追求速度的开发节奏和生产性能的当下，如何能够让快速的系统健康稳定运行，相对应的故障发现和自动化运维机制是必不可少的。期待下一次的分享。\n\n","slug":"share-redis-summary20180722","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i71000jy3uam0egjbcn","content":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li><a href=\"#overview\">需求</a></li>\n<li><a href=\"#useage\">思考与方案</a></li>\n<li><a href=\"#stage\">实现与困难</a></li>\n<li><a href=\"#summary\">效果与总结</a></li>\n</ul>\n<h1 id=\"一、需求\"><a href=\"#一、需求\" class=\"headerlink\" title=\"一、需求\"></a>一、需求</h1><p><a id=\"overview\"></a></p>\n<ul>\n<li>需求比较简单，主要是实现多个维度的客户限额控制需求。每个限额的控制有多个的维度进行分别累计控制，还包括了单笔、日累计和月累计的方式。</li>\n<li>需要支持多个不同接入系统，而且需要考虑未来的业务扩展性。</li>\n<li>能够具有较强的实时性、响应性，而且能够稳定可持续运行。</li>\n</ul>\n<h1 id=\"二、思考与方案\"><a href=\"#二、思考与方案\" class=\"headerlink\" title=\"二、思考与方案\"></a>二、思考与方案</h1><p><a id=\"useage\"></a><br>由于考虑这次项目是在支付系统中使用，常用场景是日常的高访问的支付场景以及一些秒杀、双十一等促销场景，而且涉及具有较大规模的基础用户量。自然而然，就想到了使用内存数据库进行处理。</p>\n<h2 id=\"缓存or数据库\"><a href=\"#缓存or数据库\" class=\"headerlink\" title=\"缓存or数据库\"></a>缓存or数据库</h2><p>内存数据库，顾名思义就是把数据放在内存中，直接把内存当作数据库使用。缓存，是内存数据库的应用场景之一，将进程使用的数据存在内存，达到共享、快速访问、减少数据交互的作用。但缓存毕竟不是数据库，缓存是可重新加载可丢失，而数据库却必须支持持久化、高可用、一致性的。<br>在项目初期，我们基本考虑把数据存放在内存中。但随着项目的推进，压力测试、验证等各方面的工作开展，我们发现直接使用内存作为数据库在不可丢失数据的场景下，是无法满足要求的。至少，为了保持整个内存数据库的高可用、持久化，也许我们需要更多其他的工作来达到。<br>因此，我们最终定型存储结构是Redis当作数据缓存以达到高并发的读写要求，DB2作为持久化数据库，最终数据需同步到DB2为准，也跟市场主流的用法类似。</p>\n<h2 id=\"选用Redis\"><a href=\"#选用Redis\" class=\"headerlink\" title=\"选用Redis\"></a>选用Redis</h2><p>缓存方案：Redis、ehcache、kafka等很多不同的方案。考虑行里已有Redis的实施经验，而且Redis提供的数据类型更为丰富，最重要是Redis支持持久化和成熟的高可用方案，初步定型为Redis。</p>\n<h1 id=\"三、实现与困难\"><a href=\"#三、实现与困难\" class=\"headerlink\" title=\"三、实现与困难\"></a>三、实现与困难</h1><p><a id=\"stage\"></a><br>万事起头难，从无到有的确需要经过很多不同的实践和验证。从开始以为Redis只是普通的get/set操作，常用的k-v结构存储之外，其实对于一个成熟可用的方案考虑的还不止这些。</p>\n<h2 id=\"数据存储\"><a href=\"#数据存储\" class=\"headerlink\" title=\"数据存储\"></a>数据存储</h2><ul>\n<li>数据规模</li>\n</ul>\n<p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>基数x2</td>\n<td>基数x42</td>\n<td>基数x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>十多亿</td>\n<td>几百亿</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>数据结构</li>\n</ul>\n<p>在如何规模的数量下，对于数据库都需要采取各种方案来进行提高性能和访问速度，还有节省空间。更何况是存储量级只有硬盘十分之一不到的内存呢。<br>在项目初期，确定以Redis为数据存储，DB2为数据存储的方案，与大多的方案不太一样。大多的方案是Redis的数据结构与数据库的表结构一致，根据不同的key来定义或划分数据。</p>\n<p>数据库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LimitRecord1(</span><br><span class=\"line\">userid,recordval1,...</span><br><span class=\"line\">)</span><br><span class=\"line\">LimitRecord2(</span><br><span class=\"line\">userid,condition2,recordva2,...</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>方案一：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Redis：</span><br><span class=\"line\">LimitRecord1:userid&#123;</span><br><span class=\"line\">    recordval1:value,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">LimitRecord2:userid:condition2&#123;</span><br><span class=\"line\">    recordval2:value,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方案二：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Redis:</span><br><span class=\"line\">userid:&#123;</span><br><span class=\"line\">    LimitRecord1:recordval1</span><br><span class=\"line\">    LimitRecord2.condition2:recordval1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至于那种方式更好，见仁见智，在此我们提供不同思路给大家思考。<br>对于缓存方案，多读少写第一种方案更合适。以Redis作为存储方案二相对更加节省内存使用，更适合k-v的存储数据结构。</p>\n<h2 id=\"Redis字段优化\"><a href=\"#Redis字段优化\" class=\"headerlink\" title=\"Redis字段优化\"></a>Redis字段优化</h2><p> 在日常中，缓存往往只是少量数据，如配置项、热点数据等，而本项目中，Redis承载的数据规模日常热点在几千万键的级别中，因此每一个小的字符串优化，效果都很明显也很重要。<br>优化前：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limitkey.userid.cardtype等组合</span><br></pre></td></tr></table></figure>\n<p>优化后：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l.u.c 等组合</span><br><span class=\"line\">甚至有些改为1.2.3纯数字代替</span><br></pre></td></tr></table></figure>\n<p>的确我们同事说的，这可读性降低很多，不过面对寸金尺土的内存空间，这优化还是很必要。</p>\n<p>另外，在Redis内存不同的数据结构对于内存的使用大小也是天差地别。</p>\n<table>\n<thead>\n<tr>\n<th>存储结构</th>\n<th>数据量（万）</th>\n<th>数据格式</th>\n<th>内存大小</th>\n<th>rdb文件大小</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>hash</td>\n<td>15000</td>\n<td>ziplist</td>\n<td>10.77G</td>\n<td>1.6G</td>\n</tr>\n<tr>\n<td>hash</td>\n<td>15000</td>\n<td>hashtable</td>\n<td>20.62G</td>\n<td>6.9G</td>\n</tr>\n</tbody>\n</table>\n<p>当然我们也做了很多其他不同的字段优化和测试，在此边幅有限不一一详述。</p>\n<h2 id=\"事务处理与lua脚本\"><a href=\"#事务处理与lua脚本\" class=\"headerlink\" title=\"事务处理与lua脚本\"></a>事务处理与lua脚本</h2><p>由于涉及多个限额的累计或回退、多个限额值（日累计、月累计）的一致性要求，数据库可提供事务机制实现，在Redis中，又是如何实现的。<br>Redis提供了基础的事务功能，不过涉及到锁的机制，因此对于开发要求比较高。另一方面，Redis本身每次操作都是原子性的，所以也可通过lua脚本实现。我们本次项目采取的是后者。</p>\n<p>lua脚本并不复杂，但是lua脚本类似数据库的存储过程，一旦执行，若存在死循环或者大数据量操作，对于Redis来说是致命的。因此不建议常用，也不建议滥用，我们组员很多时间都觉得，lua可以做，就可以避免多次访问Redis，减少开销。不过遇到此类场景，并没有一致性要求的，建议使用hmset、hmget等批操作，或者pipeline等方式进行访问，避免使用lua此类脚本，减少风险和排查难度。</p>\n<h2 id=\"Redis与数据库同步\"><a href=\"#Redis与数据库同步\" class=\"headerlink\" title=\"Redis与数据库同步\"></a>Redis与数据库同步</h2><p>在文章开头，提到一点很重要，也是项目必须面对的，就是Redis究竟是作为数据库还是缓存，这对于数据落地、高可用等设计都会涉及。<br>目前定位是Redis缓存、DB作为数据落地，因此如何把Redis中的数据同步到数据库也是我们纠结很久的困难点。</p>\n<h3 id=\"同步机制\"><a href=\"#同步机制\" class=\"headerlink\" title=\"同步机制\"></a>同步机制</h3><p>在Redis本身是支持类似队列或订阅机制，意味着我们可以考虑使用这两个方式触发数据同步。<br>但由于Redis的队列机制是不完整的，不完整指的是Redis并不是提供一个类似MQ、rabbitMQ等专门的队列机制，因此不建议Redis的队列服务与本身Redis的存储服务一同使用，有可能会导致队列堵塞而导致存储服务无法使用。<br>因此，项目使用了公司平台本身的队列服务，Redis仍然作为缓冲服务，避免由于高并发量和突发大数据量而导致系统不可用。</p>\n<h3 id=\"数据结构映射\"><a href=\"#数据结构映射\" class=\"headerlink\" title=\"数据结构映射\"></a>数据结构映射</h3><p>如何把Redis的存储数据与数据库表结构对应，也是我们面对的问题之一。因此大多的方式是，Redis当缓存或临时的热点数据，允许在一段周期后进行丢弃，也就是说可不用回写数据库，但本项目中的数据，最长的时间是月，这个是无法丢弃的。并且如何对于这么大的数据量在Redis中进行清理，也是一个难题。</p>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><p>另一方面，本项目采取的数据结构与数据库表结构也不一致，无法直接从Redis的数据中回写数据库。<br>我们的处理方式就是不进行同步，Redis和数据库单独管理。每次通讯请求，通过开关判断，开关用于判断使用Redis或者DB。当默认使用Redis时，程序将请求同步发送至Redis限额控制服务，当Redis处理结果成功后，将请求异步发送至平台队列中，DB限额控制服务将从队列获取信息进行处理。</p>\n<p>　<img src=\"http://oxigzlivh.bkt.clouddn.com/2018-07-22-15322700497055.jpg\" alt=\"\"></p>\n<h1 id=\"四、效果与总结\"><a href=\"#四、效果与总结\" class=\"headerlink\" title=\"四、效果与总结\"></a>四、效果与总结</h1><p><a id=\"summary\"></a><br>目前项目仍在开发中准备投产，效果如何仍需结合生产的运行情况，我们再进一步总结和归纳经验。本项目在Redis中的前期做了不少的实践，不过更多没落到实处，主要集中在性能和用法上的实践。但在项目开展时会遇到不少的难题需要解决，特别结合复杂的业务场景下，无法使用关系型数据库进行数据关联查询，无法使用事务机制控制提交回滚，更无法使用索引主键等控制约束，都是我们缺乏思考的地方。<br>下一步我们需要完善的是运维和监控，在追求速度的开发节奏和生产性能的当下，如何能够让快速的系统健康稳定运行，相对应的故障发现和自动化运维机制是必不可少的。期待下一次的分享。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li><a href=\"#overview\">需求</a></li>\n<li><a href=\"#useage\">思考与方案</a></li>\n<li><a href=\"#stage\">实现与困难</a></li>\n<li><a href=\"#summary\">效果与总结</a></li>\n</ul>\n<h1 id=\"一、需求\"><a href=\"#一、需求\" class=\"headerlink\" title=\"一、需求\"></a>一、需求</h1><p><a id=\"overview\"></a></p>\n<ul>\n<li>需求比较简单，主要是实现多个维度的客户限额控制需求。每个限额的控制有多个的维度进行分别累计控制，还包括了单笔、日累计和月累计的方式。</li>\n<li>需要支持多个不同接入系统，而且需要考虑未来的业务扩展性。</li>\n<li>能够具有较强的实时性、响应性，而且能够稳定可持续运行。</li>\n</ul>\n<h1 id=\"二、思考与方案\"><a href=\"#二、思考与方案\" class=\"headerlink\" title=\"二、思考与方案\"></a>二、思考与方案</h1><p><a id=\"useage\"></a><br>由于考虑这次项目是在支付系统中使用，常用场景是日常的高访问的支付场景以及一些秒杀、双十一等促销场景，而且涉及具有较大规模的基础用户量。自然而然，就想到了使用内存数据库进行处理。</p>\n<h2 id=\"缓存or数据库\"><a href=\"#缓存or数据库\" class=\"headerlink\" title=\"缓存or数据库\"></a>缓存or数据库</h2><p>内存数据库，顾名思义就是把数据放在内存中，直接把内存当作数据库使用。缓存，是内存数据库的应用场景之一，将进程使用的数据存在内存，达到共享、快速访问、减少数据交互的作用。但缓存毕竟不是数据库，缓存是可重新加载可丢失，而数据库却必须支持持久化、高可用、一致性的。<br>在项目初期，我们基本考虑把数据存放在内存中。但随着项目的推进，压力测试、验证等各方面的工作开展，我们发现直接使用内存作为数据库在不可丢失数据的场景下，是无法满足要求的。至少，为了保持整个内存数据库的高可用、持久化，也许我们需要更多其他的工作来达到。<br>因此，我们最终定型存储结构是Redis当作数据缓存以达到高并发的读写要求，DB2作为持久化数据库，最终数据需同步到DB2为准，也跟市场主流的用法类似。</p>\n<h2 id=\"选用Redis\"><a href=\"#选用Redis\" class=\"headerlink\" title=\"选用Redis\"></a>选用Redis</h2><p>缓存方案：Redis、ehcache、kafka等很多不同的方案。考虑行里已有Redis的实施经验，而且Redis提供的数据类型更为丰富，最重要是Redis支持持久化和成熟的高可用方案，初步定型为Redis。</p>\n<h1 id=\"三、实现与困难\"><a href=\"#三、实现与困难\" class=\"headerlink\" title=\"三、实现与困难\"></a>三、实现与困难</h1><p><a id=\"stage\"></a><br>万事起头难，从无到有的确需要经过很多不同的实践和验证。从开始以为Redis只是普通的get/set操作，常用的k-v结构存储之外，其实对于一个成熟可用的方案考虑的还不止这些。</p>\n<h2 id=\"数据存储\"><a href=\"#数据存储\" class=\"headerlink\" title=\"数据存储\"></a>数据存储</h2><ul>\n<li>数据规模</li>\n</ul>\n<p>存量客户数约5000千万左右。我们通过表格看看在这个基数下的不同额度的数据量。</p>\n<table>\n<thead>\n<tr>\n<th>额度A</th>\n<th>额度Ｂ</th>\n<th>额度C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>基数x2</td>\n<td>基数x42</td>\n<td>基数x110</td>\n</tr>\n<tr>\n<td>1亿</td>\n<td>十多亿</td>\n<td>几百亿</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>数据结构</li>\n</ul>\n<p>在如何规模的数量下，对于数据库都需要采取各种方案来进行提高性能和访问速度，还有节省空间。更何况是存储量级只有硬盘十分之一不到的内存呢。<br>在项目初期，确定以Redis为数据存储，DB2为数据存储的方案，与大多的方案不太一样。大多的方案是Redis的数据结构与数据库的表结构一致，根据不同的key来定义或划分数据。</p>\n<p>数据库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LimitRecord1(</span><br><span class=\"line\">userid,recordval1,...</span><br><span class=\"line\">)</span><br><span class=\"line\">LimitRecord2(</span><br><span class=\"line\">userid,condition2,recordva2,...</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>方案一：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Redis：</span><br><span class=\"line\">LimitRecord1:userid&#123;</span><br><span class=\"line\">    recordval1:value,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">LimitRecord2:userid:condition2&#123;</span><br><span class=\"line\">    recordval2:value,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方案二：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Redis:</span><br><span class=\"line\">userid:&#123;</span><br><span class=\"line\">    LimitRecord1:recordval1</span><br><span class=\"line\">    LimitRecord2.condition2:recordval1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至于那种方式更好，见仁见智，在此我们提供不同思路给大家思考。<br>对于缓存方案，多读少写第一种方案更合适。以Redis作为存储方案二相对更加节省内存使用，更适合k-v的存储数据结构。</p>\n<h2 id=\"Redis字段优化\"><a href=\"#Redis字段优化\" class=\"headerlink\" title=\"Redis字段优化\"></a>Redis字段优化</h2><p> 在日常中，缓存往往只是少量数据，如配置项、热点数据等，而本项目中，Redis承载的数据规模日常热点在几千万键的级别中，因此每一个小的字符串优化，效果都很明显也很重要。<br>优化前：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limitkey.userid.cardtype等组合</span><br></pre></td></tr></table></figure>\n<p>优化后：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l.u.c 等组合</span><br><span class=\"line\">甚至有些改为1.2.3纯数字代替</span><br></pre></td></tr></table></figure>\n<p>的确我们同事说的，这可读性降低很多，不过面对寸金尺土的内存空间，这优化还是很必要。</p>\n<p>另外，在Redis内存不同的数据结构对于内存的使用大小也是天差地别。</p>\n<table>\n<thead>\n<tr>\n<th>存储结构</th>\n<th>数据量（万）</th>\n<th>数据格式</th>\n<th>内存大小</th>\n<th>rdb文件大小</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>hash</td>\n<td>15000</td>\n<td>ziplist</td>\n<td>10.77G</td>\n<td>1.6G</td>\n</tr>\n<tr>\n<td>hash</td>\n<td>15000</td>\n<td>hashtable</td>\n<td>20.62G</td>\n<td>6.9G</td>\n</tr>\n</tbody>\n</table>\n<p>当然我们也做了很多其他不同的字段优化和测试，在此边幅有限不一一详述。</p>\n<h2 id=\"事务处理与lua脚本\"><a href=\"#事务处理与lua脚本\" class=\"headerlink\" title=\"事务处理与lua脚本\"></a>事务处理与lua脚本</h2><p>由于涉及多个限额的累计或回退、多个限额值（日累计、月累计）的一致性要求，数据库可提供事务机制实现，在Redis中，又是如何实现的。<br>Redis提供了基础的事务功能，不过涉及到锁的机制，因此对于开发要求比较高。另一方面，Redis本身每次操作都是原子性的，所以也可通过lua脚本实现。我们本次项目采取的是后者。</p>\n<p>lua脚本并不复杂，但是lua脚本类似数据库的存储过程，一旦执行，若存在死循环或者大数据量操作，对于Redis来说是致命的。因此不建议常用，也不建议滥用，我们组员很多时间都觉得，lua可以做，就可以避免多次访问Redis，减少开销。不过遇到此类场景，并没有一致性要求的，建议使用hmset、hmget等批操作，或者pipeline等方式进行访问，避免使用lua此类脚本，减少风险和排查难度。</p>\n<h2 id=\"Redis与数据库同步\"><a href=\"#Redis与数据库同步\" class=\"headerlink\" title=\"Redis与数据库同步\"></a>Redis与数据库同步</h2><p>在文章开头，提到一点很重要，也是项目必须面对的，就是Redis究竟是作为数据库还是缓存，这对于数据落地、高可用等设计都会涉及。<br>目前定位是Redis缓存、DB作为数据落地，因此如何把Redis中的数据同步到数据库也是我们纠结很久的困难点。</p>\n<h3 id=\"同步机制\"><a href=\"#同步机制\" class=\"headerlink\" title=\"同步机制\"></a>同步机制</h3><p>在Redis本身是支持类似队列或订阅机制，意味着我们可以考虑使用这两个方式触发数据同步。<br>但由于Redis的队列机制是不完整的，不完整指的是Redis并不是提供一个类似MQ、rabbitMQ等专门的队列机制，因此不建议Redis的队列服务与本身Redis的存储服务一同使用，有可能会导致队列堵塞而导致存储服务无法使用。<br>因此，项目使用了公司平台本身的队列服务，Redis仍然作为缓冲服务，避免由于高并发量和突发大数据量而导致系统不可用。</p>\n<h3 id=\"数据结构映射\"><a href=\"#数据结构映射\" class=\"headerlink\" title=\"数据结构映射\"></a>数据结构映射</h3><p>如何把Redis的存储数据与数据库表结构对应，也是我们面对的问题之一。因此大多的方式是，Redis当缓存或临时的热点数据，允许在一段周期后进行丢弃，也就是说可不用回写数据库，但本项目中的数据，最长的时间是月，这个是无法丢弃的。并且如何对于这么大的数据量在Redis中进行清理，也是一个难题。</p>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><p>另一方面，本项目采取的数据结构与数据库表结构也不一致，无法直接从Redis的数据中回写数据库。<br>我们的处理方式就是不进行同步，Redis和数据库单独管理。每次通讯请求，通过开关判断，开关用于判断使用Redis或者DB。当默认使用Redis时，程序将请求同步发送至Redis限额控制服务，当Redis处理结果成功后，将请求异步发送至平台队列中，DB限额控制服务将从队列获取信息进行处理。</p>\n<p>　<img src=\"http://oxigzlivh.bkt.clouddn.com/2018-07-22-15322700497055.jpg\" alt=\"\"></p>\n<h1 id=\"四、效果与总结\"><a href=\"#四、效果与总结\" class=\"headerlink\" title=\"四、效果与总结\"></a>四、效果与总结</h1><p><a id=\"summary\"></a><br>目前项目仍在开发中准备投产，效果如何仍需结合生产的运行情况，我们再进一步总结和归纳经验。本项目在Redis中的前期做了不少的实践，不过更多没落到实处，主要集中在性能和用法上的实践。但在项目开展时会遇到不少的难题需要解决，特别结合复杂的业务场景下，无法使用关系型数据库进行数据关联查询，无法使用事务机制控制提交回滚，更无法使用索引主键等控制约束，都是我们缺乏思考的地方。<br>下一步我们需要完善的是运维和监控，在追求速度的开发节奏和生产性能的当下，如何能够让快速的系统健康稳定运行，相对应的故障发现和自动化运维机制是必不可少的。期待下一次的分享。</p>\n"},{"title":"【培训】公司Redis分享会","date":"2018-06-22T09:19:03.000Z","copyright":true,"_content":"\n# 大纲\n* [Redis介绍](#overview)\n* [Redis使用](#useage)\n* [Redis场景](#stage)\n* [Redis实践](#practice)\n\n# 一、Redis介绍\n<a id=\"overview\"></a>\n## 概述\nRemote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。\n\nRedis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。\n\n它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。\n## 特性\n* Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。\n\n* Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。\n\n* Redis支持数据的备份，即master-slave模式的数据备份。\n\n## 数据结构\n### Redis支持五种数据类型：\n```\n//type的占5种类型：\n/* Object types */\n#define OBJ_STRING 0    //字符串对象\n#define OBJ_LIST 1      //列表对象\n#define OBJ_SET 2       //集合对象\n#define OBJ_ZSET 3      //有序集合对象\n#define OBJ_HASH 4      //哈希对象\n```\n\n### Redis底层的十种基础数据结构（3.2）\n```\n// encoding 的10种类型\n#define OBJ_ENCODING_RAW 0          //原始表示方式，字符串对象是简单动态字符串\n#define OBJ_ENCODING_INT 1          //long类型的整数\n#define OBJ_ENCODING_HT 2           //字典\n#define OBJ_ENCODING_ZIPMAP 3       //不在使用\n#define OBJ_ENCODING_LINKEDLIST 4   //双端链表,不在使用\n#define OBJ_ENCODING_ZIPLIST 5      //压缩列表\n#define OBJ_ENCODING_INTSET 6       //整数集合\n#define OBJ_ENCODING_SKIPLIST 7     //跳跃表和字典\n#define OBJ_ENCODING_EMBSTR 8       //embstr编码的简单动态字符串\n#define OBJ_ENCODING_QUICKLIST 9    //由压缩列表组成的双向列表-->快速列表\n```\n\n### 相互关系\n|  数据类型  |             基础数据结构 |\n|----------|-------------------------|\n|String    |INT,EMBSTR,RAW           |\n|LIST      |ZIPLIST,QUICKLIST        |\n|HASH      |ZIPLIST,HT(HASHTABLE)    |\n|SET       |INTSET,HT                |\n|ZSET      |ZIPLIST,SKIPLIST         |\n\n## 优势\n* 性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。\n\n* 丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。\n\n* 原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。\n\n* 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。\n\n# 二、Redis使用\n<a id=\"useage\"></a>\n## 安装方式\n请参考另一篇文章{% post_link course-redisInstall [Redis 3.2 详细安装步骤说明]%}\n## 常用命令\n[常用命令介绍](https://www.cnblogs.com/kevinws/p/6281395.html)\n## 持久化介绍\nRedis 分别提供了 RDB 和 AOF 两种持久化机制： \n\n* RDB \n将数据库的快照（snapshot）以二进制的方式保存到磁盘中。\n* AOF \n则以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件，以此达到记录数据库状态的目的。\n\n## 高可用\n### 主从同步\n\n### 哨兵模式\nSentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。\n参考部署架构图\n\n* 正常状态下：（A-主，B、C为从）\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206515518.jpg)\n\n* Master掉线后：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206846504.jpg)\n\n* 选举升级Slave为Master：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207006886.jpg)\n\n* 恢复正常后：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207149684.jpg)\n\n\n# 三、Redis场景\n<a id=\"stage\"></a>\n## 表数据缓存\n使用方式：直接把表数据加载至Redis中，数据类型为Hash，常用的数据库缓存的用法之一。\n\n* 一般用法：\n\n```\n如：\n **表名：**TableName\n **字段：**A,B,C,D\n 转换为Redis的存为：(结构为hash)\n **Key：**T_TableName_唯一索引\n **Field：**\n {a:val1,b:val2,c:val3,d:val4}\n```\n \n* 说明：\n此类一般保持少量并且常用的字段加载到内存中进行缓存使用，因此需要保证Field的数据量条数不多并且val字段长度不大，尽量使用Ziplist以便节省内存空间。\n## NoSQL数据库\n使用方式：直接以Redis作为数据库存储，可以同表数据缓存方式进行存放，或重新定义所需的数据结构。\n\n* 一般用法：\n\n```\n如：对象User\n\nKey为：User:uid\nField：对应属性字段\n或\nKey为：User\nField:uid.属性字段\n```\n\n* 说明：\n需要进行数据量的评估和考虑数据结构对于内存的使用。\n因为在Redis中，若所有数据均以Key-Vale的方式存放，每个key除了自身数据外，还需保留RedisObeject本身的数据空间，因此占用较大，可考虑转为Hash-Field的方式进行数据存放。\n但Hash使用两种数据结构，一个是ZipList一个是HashTable，若使用HashTable方式存放，则内存空间无法节省，因此需结合具体情况定义不同的数据结构使用方式。\n\n## 消息队列（生产者消费模式）\nRedis不仅可作为缓存服务器，还可用作消息队列。它的列表类型天生支持用作消息队列。\nRedis提供了两种方式来作消息队列。 \n一个是使用生产者消费模式，另一个就是发布订阅者模式。 \n前者会让一个或者多个客户端监听消息队列，一旦消息到达，消费者马上消费，谁先抢到算谁的，如果队列里没有消息，则消费者继续监听。 \n后者也是一个或多个客户端订阅消息频道，只要发布者发布消息，所有订阅者都能收到消息，订阅者都是平等的。\n如下图所示：\n\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297224494777.jpg)\n\n由于Redis的列表是使用双向链表实现的，保存了头尾节点，所以在列表头尾两边插取元素都是非常快的。所以可以直接使用Redis的List实现消息队列，只需简单的两个指令lpush和rpop或者rpush和lpop。\n\n## 流水号判重\nRedis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。\nRedis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。\n集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。\n我们可以使用Set进行**流水号判重操作**\n\n```\n如：\nKey:serno_YYYYMMDD\nSet:[serno1,serno2 ... sernoN]\n\nCommand：\nSADD serno_YYYYMMDD sernoX \n加入Set中，若已存在则返回0，若加入成功则返回1\n```\n\n# 四、Redis实践\n<a id=\"practice\"></a>\n## 支付系统-额度服务\n请参考另一篇文章{% post_link practice-redis-s00 [【实践】记Redis使用实践 ]%}\n## Redis数据迁移\n方案进行中，后续分享。\n\n \n\n","source":"_posts/work-redisMeeting.md","raw":"---\ntitle:  【培训】公司Redis分享会\ndate: 2018-06-22 17:19:03\ntags: \n    - 培训 \n    - redis \n    - 技术\n    - 会议\ncategories:\n    - 工作\n    - 培训\ncopyright: true\n---\n\n# 大纲\n* [Redis介绍](#overview)\n* [Redis使用](#useage)\n* [Redis场景](#stage)\n* [Redis实践](#practice)\n\n# 一、Redis介绍\n<a id=\"overview\"></a>\n## 概述\nRemote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。\n\nRedis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。\n\n它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。\n## 特性\n* Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。\n\n* Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。\n\n* Redis支持数据的备份，即master-slave模式的数据备份。\n\n## 数据结构\n### Redis支持五种数据类型：\n```\n//type的占5种类型：\n/* Object types */\n#define OBJ_STRING 0    //字符串对象\n#define OBJ_LIST 1      //列表对象\n#define OBJ_SET 2       //集合对象\n#define OBJ_ZSET 3      //有序集合对象\n#define OBJ_HASH 4      //哈希对象\n```\n\n### Redis底层的十种基础数据结构（3.2）\n```\n// encoding 的10种类型\n#define OBJ_ENCODING_RAW 0          //原始表示方式，字符串对象是简单动态字符串\n#define OBJ_ENCODING_INT 1          //long类型的整数\n#define OBJ_ENCODING_HT 2           //字典\n#define OBJ_ENCODING_ZIPMAP 3       //不在使用\n#define OBJ_ENCODING_LINKEDLIST 4   //双端链表,不在使用\n#define OBJ_ENCODING_ZIPLIST 5      //压缩列表\n#define OBJ_ENCODING_INTSET 6       //整数集合\n#define OBJ_ENCODING_SKIPLIST 7     //跳跃表和字典\n#define OBJ_ENCODING_EMBSTR 8       //embstr编码的简单动态字符串\n#define OBJ_ENCODING_QUICKLIST 9    //由压缩列表组成的双向列表-->快速列表\n```\n\n### 相互关系\n|  数据类型  |             基础数据结构 |\n|----------|-------------------------|\n|String    |INT,EMBSTR,RAW           |\n|LIST      |ZIPLIST,QUICKLIST        |\n|HASH      |ZIPLIST,HT(HASHTABLE)    |\n|SET       |INTSET,HT                |\n|ZSET      |ZIPLIST,SKIPLIST         |\n\n## 优势\n* 性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。\n\n* 丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。\n\n* 原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。\n\n* 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。\n\n# 二、Redis使用\n<a id=\"useage\"></a>\n## 安装方式\n请参考另一篇文章{% post_link course-redisInstall [Redis 3.2 详细安装步骤说明]%}\n## 常用命令\n[常用命令介绍](https://www.cnblogs.com/kevinws/p/6281395.html)\n## 持久化介绍\nRedis 分别提供了 RDB 和 AOF 两种持久化机制： \n\n* RDB \n将数据库的快照（snapshot）以二进制的方式保存到磁盘中。\n* AOF \n则以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件，以此达到记录数据库状态的目的。\n\n## 高可用\n### 主从同步\n\n### 哨兵模式\nSentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。\n参考部署架构图\n\n* 正常状态下：（A-主，B、C为从）\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206515518.jpg)\n\n* Master掉线后：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206846504.jpg)\n\n* 选举升级Slave为Master：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207006886.jpg)\n\n* 恢复正常后：\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207149684.jpg)\n\n\n# 三、Redis场景\n<a id=\"stage\"></a>\n## 表数据缓存\n使用方式：直接把表数据加载至Redis中，数据类型为Hash，常用的数据库缓存的用法之一。\n\n* 一般用法：\n\n```\n如：\n **表名：**TableName\n **字段：**A,B,C,D\n 转换为Redis的存为：(结构为hash)\n **Key：**T_TableName_唯一索引\n **Field：**\n {a:val1,b:val2,c:val3,d:val4}\n```\n \n* 说明：\n此类一般保持少量并且常用的字段加载到内存中进行缓存使用，因此需要保证Field的数据量条数不多并且val字段长度不大，尽量使用Ziplist以便节省内存空间。\n## NoSQL数据库\n使用方式：直接以Redis作为数据库存储，可以同表数据缓存方式进行存放，或重新定义所需的数据结构。\n\n* 一般用法：\n\n```\n如：对象User\n\nKey为：User:uid\nField：对应属性字段\n或\nKey为：User\nField:uid.属性字段\n```\n\n* 说明：\n需要进行数据量的评估和考虑数据结构对于内存的使用。\n因为在Redis中，若所有数据均以Key-Vale的方式存放，每个key除了自身数据外，还需保留RedisObeject本身的数据空间，因此占用较大，可考虑转为Hash-Field的方式进行数据存放。\n但Hash使用两种数据结构，一个是ZipList一个是HashTable，若使用HashTable方式存放，则内存空间无法节省，因此需结合具体情况定义不同的数据结构使用方式。\n\n## 消息队列（生产者消费模式）\nRedis不仅可作为缓存服务器，还可用作消息队列。它的列表类型天生支持用作消息队列。\nRedis提供了两种方式来作消息队列。 \n一个是使用生产者消费模式，另一个就是发布订阅者模式。 \n前者会让一个或者多个客户端监听消息队列，一旦消息到达，消费者马上消费，谁先抢到算谁的，如果队列里没有消息，则消费者继续监听。 \n后者也是一个或多个客户端订阅消息频道，只要发布者发布消息，所有订阅者都能收到消息，订阅者都是平等的。\n如下图所示：\n\n![](http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297224494777.jpg)\n\n由于Redis的列表是使用双向链表实现的，保存了头尾节点，所以在列表头尾两边插取元素都是非常快的。所以可以直接使用Redis的List实现消息队列，只需简单的两个指令lpush和rpop或者rpush和lpop。\n\n## 流水号判重\nRedis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。\nRedis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。\n集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。\n我们可以使用Set进行**流水号判重操作**\n\n```\n如：\nKey:serno_YYYYMMDD\nSet:[serno1,serno2 ... sernoN]\n\nCommand：\nSADD serno_YYYYMMDD sernoX \n加入Set中，若已存在则返回0，若加入成功则返回1\n```\n\n# 四、Redis实践\n<a id=\"practice\"></a>\n## 支付系统-额度服务\n请参考另一篇文章{% post_link practice-redis-s00 [【实践】记Redis使用实践 ]%}\n## Redis数据迁移\n方案进行中，后续分享。\n\n \n\n","slug":"work-redisMeeting","published":1,"updated":"2018-09-02T14:28:35.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjlm47i72000ly3uahcphcbw0","content":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li><a href=\"#overview\">Redis介绍</a></li>\n<li><a href=\"#useage\">Redis使用</a></li>\n<li><a href=\"#stage\">Redis场景</a></li>\n<li><a href=\"#practice\">Redis实践</a></li>\n</ul>\n<h1 id=\"一、Redis介绍\"><a href=\"#一、Redis介绍\" class=\"headerlink\" title=\"一、Redis介绍\"></a>一、Redis介绍</h1><p><a id=\"overview\"></a></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>Remote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。</p>\n<p>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>\n<p>它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>\n<h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ul>\n<li><p>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</p>\n</li>\n<li><p>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</p>\n</li>\n<li><p>Redis支持数据的备份，即master-slave模式的数据备份。</p>\n</li>\n</ul>\n<h2 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h2><h3 id=\"Redis支持五种数据类型：\"><a href=\"#Redis支持五种数据类型：\" class=\"headerlink\" title=\"Redis支持五种数据类型：\"></a>Redis支持五种数据类型：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//type的占5种类型：</span><br><span class=\"line\">/* Object types */</span><br><span class=\"line\">#define OBJ_STRING 0    //字符串对象</span><br><span class=\"line\">#define OBJ_LIST 1      //列表对象</span><br><span class=\"line\">#define OBJ_SET 2       //集合对象</span><br><span class=\"line\">#define OBJ_ZSET 3      //有序集合对象</span><br><span class=\"line\">#define OBJ_HASH 4      //哈希对象</span><br></pre></td></tr></table></figure>\n<h3 id=\"Redis底层的十种基础数据结构（3-2）\"><a href=\"#Redis底层的十种基础数据结构（3-2）\" class=\"headerlink\" title=\"Redis底层的十种基础数据结构（3.2）\"></a>Redis底层的十种基础数据结构（3.2）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// encoding 的10种类型</span><br><span class=\"line\">#define OBJ_ENCODING_RAW 0          //原始表示方式，字符串对象是简单动态字符串</span><br><span class=\"line\">#define OBJ_ENCODING_INT 1          //long类型的整数</span><br><span class=\"line\">#define OBJ_ENCODING_HT 2           //字典</span><br><span class=\"line\">#define OBJ_ENCODING_ZIPMAP 3       //不在使用</span><br><span class=\"line\">#define OBJ_ENCODING_LINKEDLIST 4   //双端链表,不在使用</span><br><span class=\"line\">#define OBJ_ENCODING_ZIPLIST 5      //压缩列表</span><br><span class=\"line\">#define OBJ_ENCODING_INTSET 6       //整数集合</span><br><span class=\"line\">#define OBJ_ENCODING_SKIPLIST 7     //跳跃表和字典</span><br><span class=\"line\">#define OBJ_ENCODING_EMBSTR 8       //embstr编码的简单动态字符串</span><br><span class=\"line\">#define OBJ_ENCODING_QUICKLIST 9    //由压缩列表组成的双向列表--&gt;快速列表</span><br></pre></td></tr></table></figure>\n<h3 id=\"相互关系\"><a href=\"#相互关系\" class=\"headerlink\" title=\"相互关系\"></a>相互关系</h3><table>\n<thead>\n<tr>\n<th>数据类型</th>\n<th>基础数据结构</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String</td>\n<td>INT,EMBSTR,RAW</td>\n</tr>\n<tr>\n<td>LIST</td>\n<td>ZIPLIST,QUICKLIST</td>\n</tr>\n<tr>\n<td>HASH</td>\n<td>ZIPLIST,HT(HASHTABLE)</td>\n</tr>\n<tr>\n<td>SET</td>\n<td>INTSET,HT</td>\n</tr>\n<tr>\n<td>ZSET</td>\n<td>ZIPLIST,SKIPLIST</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"优势\"><a href=\"#优势\" class=\"headerlink\" title=\"优势\"></a>优势</h2><ul>\n<li><p>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</p>\n</li>\n<li><p>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</p>\n</li>\n<li><p>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</p>\n</li>\n<li><p>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p>\n</li>\n</ul>\n<h1 id=\"二、Redis使用\"><a href=\"#二、Redis使用\" class=\"headerlink\" title=\"二、Redis使用\"></a>二、Redis使用</h1><p><a id=\"useage\"></a></p>\n<h2 id=\"安装方式\"><a href=\"#安装方式\" class=\"headerlink\" title=\"安装方式\"></a>安装方式</h2><p>请参考另一篇文章<a href=\"/2018/06/18/course-redisInstall/\" title=\"[Redis 3.2 详细安装步骤说明]\">[Redis 3.2 详细安装步骤说明]</a></p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p><a href=\"https://www.cnblogs.com/kevinws/p/6281395.html\" target=\"_blank\" rel=\"noopener\">常用命令介绍</a></p>\n<h2 id=\"持久化介绍\"><a href=\"#持久化介绍\" class=\"headerlink\" title=\"持久化介绍\"></a>持久化介绍</h2><p>Redis 分别提供了 RDB 和 AOF 两种持久化机制： </p>\n<ul>\n<li>RDB<br>将数据库的快照（snapshot）以二进制的方式保存到磁盘中。</li>\n<li>AOF<br>则以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件，以此达到记录数据库状态的目的。</li>\n</ul>\n<h2 id=\"高可用\"><a href=\"#高可用\" class=\"headerlink\" title=\"高可用\"></a>高可用</h2><h3 id=\"主从同步\"><a href=\"#主从同步\" class=\"headerlink\" title=\"主从同步\"></a>主从同步</h3><h3 id=\"哨兵模式\"><a href=\"#哨兵模式\" class=\"headerlink\" title=\"哨兵模式\"></a>哨兵模式</h3><p>Sentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。<br>参考部署架构图</p>\n<ul>\n<li><p>正常状态下：（A-主，B、C为从）<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206515518.jpg\" alt=\"\"></p>\n</li>\n<li><p>Master掉线后：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206846504.jpg\" alt=\"\"></p>\n</li>\n<li><p>选举升级Slave为Master：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207006886.jpg\" alt=\"\"></p>\n</li>\n<li><p>恢复正常后：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207149684.jpg\" alt=\"\"></p>\n</li>\n</ul>\n<h1 id=\"三、Redis场景\"><a href=\"#三、Redis场景\" class=\"headerlink\" title=\"三、Redis场景\"></a>三、Redis场景</h1><p><a id=\"stage\"></a></p>\n<h2 id=\"表数据缓存\"><a href=\"#表数据缓存\" class=\"headerlink\" title=\"表数据缓存\"></a>表数据缓存</h2><p>使用方式：直接把表数据加载至Redis中，数据类型为Hash，常用的数据库缓存的用法之一。</p>\n<ul>\n<li>一般用法：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：</span><br><span class=\"line\"> **表名：**TableName</span><br><span class=\"line\"> **字段：**A,B,C,D</span><br><span class=\"line\"> 转换为Redis的存为：(结构为hash)</span><br><span class=\"line\"> **Key：**T_TableName_唯一索引</span><br><span class=\"line\"> **Field：**</span><br><span class=\"line\"> &#123;a:val1,b:val2,c:val3,d:val4&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>说明：<br>此类一般保持少量并且常用的字段加载到内存中进行缓存使用，因此需要保证Field的数据量条数不多并且val字段长度不大，尽量使用Ziplist以便节省内存空间。</p>\n<h2 id=\"NoSQL数据库\"><a href=\"#NoSQL数据库\" class=\"headerlink\" title=\"NoSQL数据库\"></a>NoSQL数据库</h2><p>使用方式：直接以Redis作为数据库存储，可以同表数据缓存方式进行存放，或重新定义所需的数据结构。</p>\n</li>\n<li><p>一般用法：</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：对象User</span><br><span class=\"line\"></span><br><span class=\"line\">Key为：User:uid</span><br><span class=\"line\">Field：对应属性字段</span><br><span class=\"line\">或</span><br><span class=\"line\">Key为：User</span><br><span class=\"line\">Field:uid.属性字段</span><br></pre></td></tr></table></figure>\n<ul>\n<li>说明：<br>需要进行数据量的评估和考虑数据结构对于内存的使用。<br>因为在Redis中，若所有数据均以Key-Vale的方式存放，每个key除了自身数据外，还需保留RedisObeject本身的数据空间，因此占用较大，可考虑转为Hash-Field的方式进行数据存放。<br>但Hash使用两种数据结构，一个是ZipList一个是HashTable，若使用HashTable方式存放，则内存空间无法节省，因此需结合具体情况定义不同的数据结构使用方式。</li>\n</ul>\n<h2 id=\"消息队列（生产者消费模式）\"><a href=\"#消息队列（生产者消费模式）\" class=\"headerlink\" title=\"消息队列（生产者消费模式）\"></a>消息队列（生产者消费模式）</h2><p>Redis不仅可作为缓存服务器，还可用作消息队列。它的列表类型天生支持用作消息队列。<br>Redis提供了两种方式来作消息队列。<br>一个是使用生产者消费模式，另一个就是发布订阅者模式。<br>前者会让一个或者多个客户端监听消息队列，一旦消息到达，消费者马上消费，谁先抢到算谁的，如果队列里没有消息，则消费者继续监听。<br>后者也是一个或多个客户端订阅消息频道，只要发布者发布消息，所有订阅者都能收到消息，订阅者都是平等的。<br>如下图所示：</p>\n<p><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297224494777.jpg\" alt=\"\"></p>\n<p>由于Redis的列表是使用双向链表实现的，保存了头尾节点，所以在列表头尾两边插取元素都是非常快的。所以可以直接使用Redis的List实现消息队列，只需简单的两个指令lpush和rpop或者rpush和lpop。</p>\n<h2 id=\"流水号判重\"><a href=\"#流水号判重\" class=\"headerlink\" title=\"流水号判重\"></a>流水号判重</h2><p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。<br>Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。<br>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。<br>我们可以使用Set进行<strong>流水号判重操作</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：</span><br><span class=\"line\">Key:serno_YYYYMMDD</span><br><span class=\"line\">Set:[serno1,serno2 ... sernoN]</span><br><span class=\"line\"></span><br><span class=\"line\">Command：</span><br><span class=\"line\">SADD serno_YYYYMMDD sernoX </span><br><span class=\"line\">加入Set中，若已存在则返回0，若加入成功则返回1</span><br></pre></td></tr></table></figure>\n<h1 id=\"四、Redis实践\"><a href=\"#四、Redis实践\" class=\"headerlink\" title=\"四、Redis实践\"></a>四、Redis实践</h1><p><a id=\"practice\"></a></p>\n<h2 id=\"支付系统-额度服务\"><a href=\"#支付系统-额度服务\" class=\"headerlink\" title=\"支付系统-额度服务\"></a>支付系统-额度服务</h2><p>请参考另一篇文章</p>\n<h2 id=\"Redis数据迁移\"><a href=\"#Redis数据迁移\" class=\"headerlink\" title=\"Redis数据迁移\"></a>Redis数据迁移</h2><p>方案进行中，后续分享。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"大纲\"><a href=\"#大纲\" class=\"headerlink\" title=\"大纲\"></a>大纲</h1><ul>\n<li><a href=\"#overview\">Redis介绍</a></li>\n<li><a href=\"#useage\">Redis使用</a></li>\n<li><a href=\"#stage\">Redis场景</a></li>\n<li><a href=\"#practice\">Redis实践</a></li>\n</ul>\n<h1 id=\"一、Redis介绍\"><a href=\"#一、Redis介绍\" class=\"headerlink\" title=\"一、Redis介绍\"></a>一、Redis介绍</h1><p><a id=\"overview\"></a></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>Remote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。</p>\n<p>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>\n<p>它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>\n<h2 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h2><ul>\n<li><p>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</p>\n</li>\n<li><p>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</p>\n</li>\n<li><p>Redis支持数据的备份，即master-slave模式的数据备份。</p>\n</li>\n</ul>\n<h2 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h2><h3 id=\"Redis支持五种数据类型：\"><a href=\"#Redis支持五种数据类型：\" class=\"headerlink\" title=\"Redis支持五种数据类型：\"></a>Redis支持五种数据类型：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//type的占5种类型：</span><br><span class=\"line\">/* Object types */</span><br><span class=\"line\">#define OBJ_STRING 0    //字符串对象</span><br><span class=\"line\">#define OBJ_LIST 1      //列表对象</span><br><span class=\"line\">#define OBJ_SET 2       //集合对象</span><br><span class=\"line\">#define OBJ_ZSET 3      //有序集合对象</span><br><span class=\"line\">#define OBJ_HASH 4      //哈希对象</span><br></pre></td></tr></table></figure>\n<h3 id=\"Redis底层的十种基础数据结构（3-2）\"><a href=\"#Redis底层的十种基础数据结构（3-2）\" class=\"headerlink\" title=\"Redis底层的十种基础数据结构（3.2）\"></a>Redis底层的十种基础数据结构（3.2）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// encoding 的10种类型</span><br><span class=\"line\">#define OBJ_ENCODING_RAW 0          //原始表示方式，字符串对象是简单动态字符串</span><br><span class=\"line\">#define OBJ_ENCODING_INT 1          //long类型的整数</span><br><span class=\"line\">#define OBJ_ENCODING_HT 2           //字典</span><br><span class=\"line\">#define OBJ_ENCODING_ZIPMAP 3       //不在使用</span><br><span class=\"line\">#define OBJ_ENCODING_LINKEDLIST 4   //双端链表,不在使用</span><br><span class=\"line\">#define OBJ_ENCODING_ZIPLIST 5      //压缩列表</span><br><span class=\"line\">#define OBJ_ENCODING_INTSET 6       //整数集合</span><br><span class=\"line\">#define OBJ_ENCODING_SKIPLIST 7     //跳跃表和字典</span><br><span class=\"line\">#define OBJ_ENCODING_EMBSTR 8       //embstr编码的简单动态字符串</span><br><span class=\"line\">#define OBJ_ENCODING_QUICKLIST 9    //由压缩列表组成的双向列表--&gt;快速列表</span><br></pre></td></tr></table></figure>\n<h3 id=\"相互关系\"><a href=\"#相互关系\" class=\"headerlink\" title=\"相互关系\"></a>相互关系</h3><table>\n<thead>\n<tr>\n<th>数据类型</th>\n<th>基础数据结构</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String</td>\n<td>INT,EMBSTR,RAW</td>\n</tr>\n<tr>\n<td>LIST</td>\n<td>ZIPLIST,QUICKLIST</td>\n</tr>\n<tr>\n<td>HASH</td>\n<td>ZIPLIST,HT(HASHTABLE)</td>\n</tr>\n<tr>\n<td>SET</td>\n<td>INTSET,HT</td>\n</tr>\n<tr>\n<td>ZSET</td>\n<td>ZIPLIST,SKIPLIST</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"优势\"><a href=\"#优势\" class=\"headerlink\" title=\"优势\"></a>优势</h2><ul>\n<li><p>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</p>\n</li>\n<li><p>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</p>\n</li>\n<li><p>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</p>\n</li>\n<li><p>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p>\n</li>\n</ul>\n<h1 id=\"二、Redis使用\"><a href=\"#二、Redis使用\" class=\"headerlink\" title=\"二、Redis使用\"></a>二、Redis使用</h1><p><a id=\"useage\"></a></p>\n<h2 id=\"安装方式\"><a href=\"#安装方式\" class=\"headerlink\" title=\"安装方式\"></a>安装方式</h2><p>请参考另一篇文章<a href=\"/2018/06/18/course-redisInstall/\" title=\"[Redis 3.2 详细安装步骤说明]\">[Redis 3.2 详细安装步骤说明]</a></p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p><a href=\"https://www.cnblogs.com/kevinws/p/6281395.html\" target=\"_blank\" rel=\"noopener\">常用命令介绍</a></p>\n<h2 id=\"持久化介绍\"><a href=\"#持久化介绍\" class=\"headerlink\" title=\"持久化介绍\"></a>持久化介绍</h2><p>Redis 分别提供了 RDB 和 AOF 两种持久化机制： </p>\n<ul>\n<li>RDB<br>将数据库的快照（snapshot）以二进制的方式保存到磁盘中。</li>\n<li>AOF<br>则以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件，以此达到记录数据库状态的目的。</li>\n</ul>\n<h2 id=\"高可用\"><a href=\"#高可用\" class=\"headerlink\" title=\"高可用\"></a>高可用</h2><h3 id=\"主从同步\"><a href=\"#主从同步\" class=\"headerlink\" title=\"主从同步\"></a>主从同步</h3><h3 id=\"哨兵模式\"><a href=\"#哨兵模式\" class=\"headerlink\" title=\"哨兵模式\"></a>哨兵模式</h3><p>Sentinel（哨兵）是Redis 的高可用性解决方案：由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。<br>参考部署架构图</p>\n<ul>\n<li><p>正常状态下：（A-主，B、C为从）<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206515518.jpg\" alt=\"\"></p>\n</li>\n<li><p>Master掉线后：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297206846504.jpg\" alt=\"\"></p>\n</li>\n<li><p>选举升级Slave为Master：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207006886.jpg\" alt=\"\"></p>\n</li>\n<li><p>恢复正常后：<br><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297207149684.jpg\" alt=\"\"></p>\n</li>\n</ul>\n<h1 id=\"三、Redis场景\"><a href=\"#三、Redis场景\" class=\"headerlink\" title=\"三、Redis场景\"></a>三、Redis场景</h1><p><a id=\"stage\"></a></p>\n<h2 id=\"表数据缓存\"><a href=\"#表数据缓存\" class=\"headerlink\" title=\"表数据缓存\"></a>表数据缓存</h2><p>使用方式：直接把表数据加载至Redis中，数据类型为Hash，常用的数据库缓存的用法之一。</p>\n<ul>\n<li>一般用法：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：</span><br><span class=\"line\"> **表名：**TableName</span><br><span class=\"line\"> **字段：**A,B,C,D</span><br><span class=\"line\"> 转换为Redis的存为：(结构为hash)</span><br><span class=\"line\"> **Key：**T_TableName_唯一索引</span><br><span class=\"line\"> **Field：**</span><br><span class=\"line\"> &#123;a:val1,b:val2,c:val3,d:val4&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>说明：<br>此类一般保持少量并且常用的字段加载到内存中进行缓存使用，因此需要保证Field的数据量条数不多并且val字段长度不大，尽量使用Ziplist以便节省内存空间。</p>\n<h2 id=\"NoSQL数据库\"><a href=\"#NoSQL数据库\" class=\"headerlink\" title=\"NoSQL数据库\"></a>NoSQL数据库</h2><p>使用方式：直接以Redis作为数据库存储，可以同表数据缓存方式进行存放，或重新定义所需的数据结构。</p>\n</li>\n<li><p>一般用法：</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：对象User</span><br><span class=\"line\"></span><br><span class=\"line\">Key为：User:uid</span><br><span class=\"line\">Field：对应属性字段</span><br><span class=\"line\">或</span><br><span class=\"line\">Key为：User</span><br><span class=\"line\">Field:uid.属性字段</span><br></pre></td></tr></table></figure>\n<ul>\n<li>说明：<br>需要进行数据量的评估和考虑数据结构对于内存的使用。<br>因为在Redis中，若所有数据均以Key-Vale的方式存放，每个key除了自身数据外，还需保留RedisObeject本身的数据空间，因此占用较大，可考虑转为Hash-Field的方式进行数据存放。<br>但Hash使用两种数据结构，一个是ZipList一个是HashTable，若使用HashTable方式存放，则内存空间无法节省，因此需结合具体情况定义不同的数据结构使用方式。</li>\n</ul>\n<h2 id=\"消息队列（生产者消费模式）\"><a href=\"#消息队列（生产者消费模式）\" class=\"headerlink\" title=\"消息队列（生产者消费模式）\"></a>消息队列（生产者消费模式）</h2><p>Redis不仅可作为缓存服务器，还可用作消息队列。它的列表类型天生支持用作消息队列。<br>Redis提供了两种方式来作消息队列。<br>一个是使用生产者消费模式，另一个就是发布订阅者模式。<br>前者会让一个或者多个客户端监听消息队列，一旦消息到达，消费者马上消费，谁先抢到算谁的，如果队列里没有消息，则消费者继续监听。<br>后者也是一个或多个客户端订阅消息频道，只要发布者发布消息，所有订阅者都能收到消息，订阅者都是平等的。<br>如下图所示：</p>\n<p><img src=\"http://oxigzlivh.bkt.clouddn.com/2018-06-23-15297224494777.jpg\" alt=\"\"></p>\n<p>由于Redis的列表是使用双向链表实现的，保存了头尾节点，所以在列表头尾两边插取元素都是非常快的。所以可以直接使用Redis的List实现消息队列，只需简单的两个指令lpush和rpop或者rpush和lpop。</p>\n<h2 id=\"流水号判重\"><a href=\"#流水号判重\" class=\"headerlink\" title=\"流水号判重\"></a>流水号判重</h2><p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。<br>Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。<br>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。<br>我们可以使用Set进行<strong>流水号判重操作</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如：</span><br><span class=\"line\">Key:serno_YYYYMMDD</span><br><span class=\"line\">Set:[serno1,serno2 ... sernoN]</span><br><span class=\"line\"></span><br><span class=\"line\">Command：</span><br><span class=\"line\">SADD serno_YYYYMMDD sernoX </span><br><span class=\"line\">加入Set中，若已存在则返回0，若加入成功则返回1</span><br></pre></td></tr></table></figure>\n<h1 id=\"四、Redis实践\"><a href=\"#四、Redis实践\" class=\"headerlink\" title=\"四、Redis实践\"></a>四、Redis实践</h1><p><a id=\"practice\"></a></p>\n<h2 id=\"支付系统-额度服务\"><a href=\"#支付系统-额度服务\" class=\"headerlink\" title=\"支付系统-额度服务\"></a>支付系统-额度服务</h2><p>请参考另一篇文章</p>\n<h2 id=\"Redis数据迁移\"><a href=\"#Redis数据迁移\" class=\"headerlink\" title=\"Redis数据迁移\"></a>Redis数据迁移</h2><p>方案进行中，后续分享。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjlm47i6s0009y3uac8k9u37c","category_id":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i74000oy3uaoa3qdeht"},{"post_id":"cjlm47i6s0009y3uac8k9u37c","category_id":"cjlm47i70000iy3ua8stk99ic","_id":"cjlm47i76000qy3ua6d52f8pd"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","category_id":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i77000ty3uasmla07fx"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","category_id":"cjlm47i73000my3uapzzobh5e","_id":"cjlm47i77000vy3ua2wq3r17j"},{"post_id":"cjlm47i6u000cy3ua0y7tww0w","category_id":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i78000yy3uac10pxu6d"},{"post_id":"cjlm47i6u000cy3ua0y7tww0w","category_id":"cjlm47i70000iy3ua8stk99ic","_id":"cjlm47i780011y3uar69mhjsh"},{"post_id":"cjlm47i6r0008y3uaavfy53nj","category_id":"cjlm47i6v000dy3ua3ewboqwx","_id":"cjlm47i790015y3ua194d0oev"},{"post_id":"cjlm47i6r0008y3uaavfy53nj","category_id":"cjlm47i76000sy3uamk26sqqi","_id":"cjlm47i790017y3uasp81gmps"},{"post_id":"cjlm47i71000jy3uam0egjbcn","category_id":"cjlm47i6q0007y3uahp37zwc4","_id":"cjlm47i7a0019y3uaj1yqhyu4"},{"post_id":"cjlm47i71000jy3uam0egjbcn","category_id":"cjlm47i780010y3uacnfow04f","_id":"cjlm47i7a001ay3uasuhx5to1"},{"post_id":"cjlm47i72000ly3uahcphcbw0","category_id":"cjlm47i790016y3uay2nn1j82","_id":"cjlm47i7c001iy3ua2jtyr7ex"},{"post_id":"cjlm47i72000ly3uahcphcbw0","category_id":"cjlm47i7a001cy3uapmxgmuf2","_id":"cjlm47i7c001ky3uaf71ax598"}],"PostTag":[{"post_id":"cjlm47i6r0008y3uaavfy53nj","tag_id":"cjlm47i6m0004y3uas0dor03i","_id":"cjlm47i6u000by3ua3h6qh0k8"},{"post_id":"cjlm47i6e0000y3uawq3jcxi5","tag_id":"cjlm47i6m0004y3uas0dor03i","_id":"cjlm47i6v000ey3ua9954hnno"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i77000uy3uav8i2wp7t"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i77000wy3ua0hksl39a"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","tag_id":"cjlm47i72000ky3uanh5vin3c","_id":"cjlm47i78000zy3ual147t5fw"},{"post_id":"cjlm47i6k0002y3ua51lvuze3","tag_id":"cjlm47i74000ny3ualpta2tux","_id":"cjlm47i780012y3uawljhedd8"},{"post_id":"cjlm47i6o0005y3uavx2nmza2","tag_id":"cjlm47i76000ry3uae0xxcxed","_id":"cjlm47i790014y3uaq0rsrtyq"},{"post_id":"cjlm47i6s0009y3uac8k9u37c","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7b001dy3uapggg6jjz"},{"post_id":"cjlm47i6s0009y3uac8k9u37c","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7b001ey3ua4qx0d20g"},{"post_id":"cjlm47i6s0009y3uac8k9u37c","tag_id":"cjlm47i72000ky3uanh5vin3c","_id":"cjlm47i7b001gy3uawksprx79"},{"post_id":"cjlm47i6u000cy3ua0y7tww0w","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7c001jy3uazlxza523"},{"post_id":"cjlm47i6u000cy3ua0y7tww0w","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7c001ly3uan6v50tp5"},{"post_id":"cjlm47i6u000cy3ua0y7tww0w","tag_id":"cjlm47i72000ky3uanh5vin3c","_id":"cjlm47i7d001ny3uaryb6mgy0"},{"post_id":"cjlm47i6w000fy3uajyvx4wug","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7e001py3uay4p2t7zw"},{"post_id":"cjlm47i6w000fy3uajyvx4wug","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7e001qy3uawmwaimft"},{"post_id":"cjlm47i6w000fy3uajyvx4wug","tag_id":"cjlm47i72000ky3uanh5vin3c","_id":"cjlm47i7e001sy3uatgb8ko6h"},{"post_id":"cjlm47i6z000hy3uap6iel80y","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7e001ty3uac2zvrox1"},{"post_id":"cjlm47i6z000hy3uap6iel80y","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7f001vy3uabqhxd68a"},{"post_id":"cjlm47i6z000hy3uap6iel80y","tag_id":"cjlm47i72000ky3uanh5vin3c","_id":"cjlm47i7f001wy3uazkojv6ta"},{"post_id":"cjlm47i71000jy3uam0egjbcn","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7f001yy3uafnn20zv4"},{"post_id":"cjlm47i71000jy3uam0egjbcn","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7f001zy3uayc4s6zdy"},{"post_id":"cjlm47i71000jy3uam0egjbcn","tag_id":"cjlm47i7e001ry3ua89we6btt","_id":"cjlm47i7g0021y3ua2wdgqsf5"},{"post_id":"cjlm47i71000jy3uam0egjbcn","tag_id":"cjlm47i74000ny3ualpta2tux","_id":"cjlm47i7g0022y3uavgxjly38"},{"post_id":"cjlm47i72000ly3uahcphcbw0","tag_id":"cjlm47i7f001xy3uafya7nzsb","_id":"cjlm47i7g0023y3uar7mordpw"},{"post_id":"cjlm47i72000ly3uahcphcbw0","tag_id":"cjlm47i6z000gy3uar2l6n8tq","_id":"cjlm47i7g0024y3uau8nw1ix1"},{"post_id":"cjlm47i72000ly3uahcphcbw0","tag_id":"cjlm47i6t000ay3uawg9yvdzk","_id":"cjlm47i7g0025y3ua045z2f9l"},{"post_id":"cjlm47i72000ly3uahcphcbw0","tag_id":"cjlm47i7f0020y3uaohza5lfe","_id":"cjlm47i7g0026y3ua3qxmlkep"}],"Tag":[{"name":"生活","_id":"cjlm47i6m0004y3uas0dor03i"},{"name":"技术","_id":"cjlm47i6t000ay3uawg9yvdzk"},{"name":"redis","_id":"cjlm47i6z000gy3uar2l6n8tq"},{"name":"教程","_id":"cjlm47i72000ky3uanh5vin3c"},{"name":"生产","_id":"cjlm47i74000ny3ualpta2tux"},{"name":"博客","_id":"cjlm47i76000ry3uae0xxcxed"},{"name":"项目","_id":"cjlm47i7e001ry3ua89we6btt"},{"name":"培训","_id":"cjlm47i7f001xy3uafya7nzsb"},{"name":"会议","_id":"cjlm47i7f0020y3uaohza5lfe"}]}}